import{j as e,D as O,E as V,F as Y,G as q,B as g,a3 as U,d as B,e as $,C as z}from"./index-Bt7t-uRm.js";import{u as Z}from"./use-request-B4L2sB-F.js";import{u as J,b as m}from"./user-ReaFp5d6.js";import{r as o}from"./vendor-core-CiUIJZ_7.js";import{u as Q,C as E}from"./index.esm-BGUB25Qb.js";import{e as h,I as P,S as T,F as W,s as b,f as X,c as ee}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";function se({title:d,show:r,formValue:a,onOk:v,onCancel:p,dataPerson:N,dataYegan:A}){const{control:i,handleSubmit:D,reset:f,formState:{errors:c,isValid:j}}=Q({defaultValues:a,mode:"onChange"});o.useEffect(()=>{f(a)},[a,f]);const y=t=>{const n={...t};v(n,a.id?"edit":"add")};return e.jsx(O,{open:r,onOpenChange:t=>!t&&p(),children:e.jsxs(V,{children:[e.jsx(Y,{children:e.jsx(q,{children:d})}),e.jsxs("form",{onSubmit:D(y),className:"space-y-4",children:[e.jsxs(h.Item,{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"شماره حساب"}),e.jsx(E,{name:"number_hesab",control:i,rules:{required:"شماره حساب الزامی است",pattern:{value:/^[0-9]+$/,message:"شماره حساب باید فقط عدد باشد"},minLength:{value:10,message:"شماره حساب باید حداقل ۱۰ رقم باشد"},maxLength:{value:20,message:"شماره حساب باید حداکثر ۲۰ رقم باشد"}},render:({field:t})=>e.jsx(P,{...t,value:t.value||"",className:"w-full"})}),c.number_hesab&&e.jsx("p",{className:"text-error mt-0.5 ",children:c.number_hesab.message})]}),e.jsxs(h.Item,{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"عنوان حساب"}),e.jsx(E,{name:"onvan_hesab",control:i,rules:{required:"عنوان حساب الزامی است",minLength:{value:3,message:"عنوان حساب باید حداقل ۳ کاراکتر باشد"},maxLength:{value:50,message:"عنوان حساب باید حداکثر ۵۰ کاراکتر باشد"},pattern:{value:/^[آ-یA-Za-z\s]+$/,message:"عنوان حساب باید فقط شامل حروف باشد"}},render:({field:t})=>e.jsx(P,{...t,value:t.value||"",className:"w-full"})}),c.onvan_hesab&&e.jsx("p",{className:"text-error mt-0.5 ",children:c.onvan_hesab.message})]}),e.jsxs(h.Item,{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"انتخاب عامل خرید"}),e.jsx(E,{name:"person_id",control:i,rules:{required:"لطفا عامل خرید را انتخاب کنید"},render:({field:t})=>e.jsxs("select",{...t,value:t.value??void 0,className:"w-full px-2 py-1 border border-accent rounded-md",children:[e.jsx("option",{value:"",className:"bg-background",children:"انتخاب کنید"}),N.map(n=>e.jsx("option",{value:n.id,className:"bg-background",children:n.name+" "+n.family},n.id))]})}),c.person_id&&e.jsx("p",{className:"text-error mt-0.5",children:c.person_id.message})]}),e.jsxs(h.Item,{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"انتخاب یگان"}),e.jsx(E,{name:"yegan_id",control:i,rules:{required:"لطفا یگان را انتخاب کنید"},render:({field:t})=>e.jsxs("select",{...t,value:t.value??void 0,className:"w-full px-2 py-1 border border-accent rounded-md",children:[e.jsx("option",{value:"",className:"bg-background",children:"انتخاب کنید"}),A.map(n=>e.jsx("option",{value:n.id,className:"bg-background",children:"  نام یگان » "+n.name+" کد یگان » "+n.code},n.id))]})}),c.yegan_id&&e.jsx("p",{className:"text-error mt-0.5",children:c.yegan_id.message})]}),e.jsxs(h.Item,{className:"flex justify-end items-center gap-5 mt-4",children:[e.jsx(g,{type:"button",className:"px-5 py-2 rounded-md ml-2 border-gray-300 text-white bg-error/50 hover:bg-error",onClick:p,children:"انصراف"}),e.jsx(g,{type:"submit",disabled:!j,className:`px-5 py-2 rounded-md text-white ${j?"bg-success/70 hover:bg-success":"bg-gray-400 cursor-not-allowed"}`,children:a?.id?"ویرایش":"افزودن"})]})]})]})})}const{Option:_}=T,ae={person_id:null,yegan_id:null,number_hesab:null,onvan_hesab:null},te=()=>{const{can:d}=J(),{operationList:r,resourceList:a}=U,[v,p]=o.useState([]),[N,A]=o.useState([]),[i,D]=o.useState([]),[f]=h.useForm(),[c,j]=o.useState(""),[y,t]=o.useState(Date.now()),[n,L]=o.useState({show:!1,title:"افزودن عامل جدید",formValue:ae}),u=Z(),w=u.useGetData(m(a.AMELE_KHARID,r.GETALL)),C=u.useGetData(m(a.YEGAN,r.GETALL)),S=u.useGetData(m(a.PERSONS,r.GETALL)),M=u.useUpdateData(m(a.AMELE_KHARID,r.UPDATE,n?.formValue.id)),k=u.usePostData(m(a.AMELE_KHARID,r.CREATE)),H=u.useDeleteData(m(a.AMELE_KHARID,r.DELETE));o.useEffect(()=>{let s=!0;return s&&d(a.AMELE_KHARID,r.GETALL)&&w.fetchData(),()=>{s=!1}},[y]),o.useEffect(()=>{const s=w.data;s?.success&&s.data&&p(s.data)},[w.data]),o.useEffect(()=>{let s=!1;!s&&d(a.YEGAN,r.GETALL)&&d(a.PERSONS,r.GETALL)&&(C.fetchData(),S.fetchData(),s=!0)},[]),o.useEffect(()=>{const s=C.data;s?.success&&s.data&&A(s.data);const l=S.data;l?.success&&l.data&&D(l.data)},[C.data,S.data]);const R=()=>{L(s=>({...s,show:!1}))},G=async(s,l)=>{let x;l==="add"?x=await k.sendData({person_id:Number(s.person_id),yegan_id:Number(s.yegan_id),onvan_hesab:s.onvan_hesab,number_hesab:s.number_hesab}):x=await M.sendData({person_id:Number(s.person_id),yegan_id:Number(s.yegan_id),onvan_hesab:s.onvan_hesab,number_hesab:s.number_hesab}),x&&(t(Date.now()),l==="add"?b.success("عامل خرید جدید اضافه شد"):b.info("عامل خرید ویرایش شد")),R()},K=async s=>{try{let l;s&&(l=await H.remove("/"+s.toString())),l?.success?(b.success("با موفقیت حذف شد"),t(Date.now())):b.error("خطا در حذف")}catch(l){b.error(l.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},F=()=>{const s={canEdit:d(a.AMELE_KHARID,r.UPDATE),canDelete:d(a.AMELE_KHARID,r.DELETE)},l=[{title:"کد عامل خرید",dataIndex:"person_id",key:"person_id"},{title:"نام عامل خرید",dataIndex:"person_id",key:"person_id"},{title:"شماره حساب",dataIndex:"number_hesab",key:"number_hesab"},{title:"عنوان حساب",dataIndex:"onvan_hesab",key:"onvan_hesab"}],x={title:"عملیات",key:"actions",render:(ne,I)=>e.jsxs(X,{children:[s.canEdit&&e.jsx(g,{onClick:()=>{f.setFieldsValue(I),L({show:!0,title:"ویرایش عامل خرید",formValue:I})},className:"bg-chart3 text-white font-bold hover:bg-primary cursor-pointer ",children:"ویرایش"}),s.canDelete&&e.jsx(ee,{title:"آیا مطمئن هستید؟",onConfirm:()=>K(I.id??null),children:e.jsx(g,{className:"bg-error-light hover:bg-error cursor-pointer text-white",children:"حذف"})})]})};return(s.canEdit||s.canDelete)&&l.push(x),l};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"flex items-center justify-between flex-col sm:flex-row gap-4 sm:gap-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-right w-full sm:w-auto",children:"مدیریت عاملین خرید"}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[d(a.AMELE_KHARID,r.SEARCH)&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{style:{width:160},children:[e.jsx(_,{value:"code",children:"کد عامل خرید"}),e.jsx(_,{value:"name",children:"نام عامل خرید"}),e.jsx(_,{value:"accountNumber",children:"شماره حساب"}),e.jsx(_,{value:"accountTitle",children:"عنوان حساب"})]}),e.jsx(P,{placeholder:"متن جستجو",value:c,onChange:s=>j(s.target.value),style:{width:250}})]}),d(a.AMELE_KHARID,r.CREATE)&&e.jsx(g,{className:"text-white cursor-pointer",onClick:()=>L(s=>({...s,show:!0})),children:"افزودن عامل خرید"})]})]}),e.jsx($,{children:e.jsx(W,{rowKey:"id",columns:F(),dataSource:v,pagination:{pageSize:5}})}),n.show&&e.jsx(se,{title:n.title,show:n.show,formValue:n.formValue,onOk:G,onCancel:R,dataPerson:i,dataYegan:N})]})},me=()=>e.jsx(z,{children:e.jsx(te,{})});export{me as default};
