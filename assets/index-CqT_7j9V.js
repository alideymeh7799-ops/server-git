import{a3 as A,j as s,C as _,d as U,B as b}from"./index-Bt7t-uRm.js";import{u as L}from"./use-request-B4L2sB-F.js";import{u as V,b as f}from"./user-ReaFp5d6.js";import{r as i}from"./vendor-core-CiUIJZ_7.js";/* empty css               */import{U as D,u as F,r as M}from"./create-user-modal-BythrEDj.js";import{e as B,S as G,I as H,g as z,F as K,s as d,f as $,b as w,c as q,d as J}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";const Q={name:null,family:null,id_number:null,personnel_number:null,accountNumber:null,bankCode:null,fmoSource:null,hsaSource:null,hsoSource:null},oe=()=>{const{can:r}=V(),{operationList:t,resourceList:a}=A,[E]=B.useForm(),[C,y]=i.useState([]),[N,k]=i.useState(""),[I,h]=i.useState(Date.now()),[c,x]=i.useState({show:!1,title:"افزودن کاربر",formValue:Q}),m=L(),S=m.useGetData(f(a.PERSONS,t.GETALL)),j=m.useUpdateData(f(a.PERSONS,t.UPDATE,c?.formValue.id)),g=m.usePostData(f(a.PERSONS,t.CREATE)),P=m.useDeleteData(f(a.PERSONS,t.DELETE));i.useEffect(()=>{r(a.PERSONS,t.GETALL)&&S.fetchData()},[I]),i.useEffect(()=>{const e=S.data;e?.success&&e.data&&y(e.data)},[S.data]);const p=()=>{x(e=>({...e,show:!1}))},R=async(e,o)=>{let u;o==="add"?u=await g.sendData({name:e.name,family:e.family,unitCode:e.accountNumber,nationalId:e.nationalId,accountNumber:e.accountNumber,bankCode:e.bankCode,hsaSource:e.hsaSource,fmoSource:e.fmoSource,hsoSource:e.hsoSource,personnel_number:e.personnelId}):u=await j.sendData({name:e.name,firstName:e.family,id_number:e.id_number,nationalId:e.nationalId,accountNumber:e.accountNumber,bankCode:e.bankCode,hsaSource:e.hsaSource,fmoSource:e.fmoSource,hsoSource:e.hsoSource,personnel_number:e.personnelId}),u&&(h(Date.now()),o==="add"?d.success(" پرسنل جدید اضافه شد"):d.info(" پرسنل ویرایش شد")),p()},T=async e=>{try{let o;e&&(o=await P.remove(e.toString())),o?.success?(d.success("با موفقیت حذف شد"),h(Date.now())):d.error("خطا در حذف")}catch(o){d.error(o.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},v=()=>{const e={canEdit:r(a.PERSONS,t.UPDATE),canDelete:r(a.PERSONS,t.DELETE)},o=[{title:"شماره پرسنلی",dataIndex:"personnel_number",key:"personnel_number"},{title:"نام",dataIndex:"name",key:"name",filteredValue:[N]},{title:"نام خانوادگی",dataIndex:"family",key:"family"},{title:"کد یگان",dataIndex:"unitCode",key:"unitCode",render:l=>F.find(n=>n.value===l)?.label||l},{title:"درجه",dataIndex:"rank",key:"rank",render:l=>M.find(n=>n.value===l)?.label||l},{title:"شماره ملی",dataIndex:"id_number",key:"id_number"},{title:"شماره حساب",dataIndex:"accountNumber",key:"accountNumber"},{title:"کد بانک",dataIndex:"bankCode",key:"bankCode"},{title:"ماخذ HSA",dataIndex:"hsaSource",key:"hsaSource"},{title:"ماخذ FMO",dataIndex:"fmoSource",key:"fmoSource"},{title:"ماخذ HSO",dataIndex:"hsoSource",key:"hsoSource"}],u={title:"عملیات",key:"actions",render:(l,n)=>s.jsx("div",{className:"flex gap-2 items-center",children:(r(a.CREDITBUDGET,t.UPDATE)||r(a.CREDITBUDGET,t.CREATE))&&s.jsxs($,{size:"middle",children:[s.jsxs(b,{className:"flex items-center cursor-pointer justify-center px-4 py-1 text-sm font-medium font-iransans bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",onClick:()=>x(O=>({...O,show:!0,title:"ویرایش شخص",formValue:n})),children:[s.jsx(w,{}),"ویرایش"]}),s.jsx(q,{title:"آیا از حذف این کاربر مطمئن هستید؟",onConfirm:()=>T(n.id?n.id:null),okText:"بله",cancelText:"خیر",children:s.jsxs(b,{className:"flex cursor-pointer items-center justify-center px-4 py-1 text-sm font-medium font-iransans bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors",children:[" ",s.jsx(J,{}),"حذف"]})})]})})};return(e.canEdit||e.canDelete)&&o.push(u),o};return s.jsxs(_,{children:[s.jsx(U,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"font-bold text-3xl",children:"لیست پرسنل"}),s.jsxs("div",{className:"flex items-center  gap-2",children:[r(a.PERSONS,t.CREATE)&&s.jsx(b,{onClick:()=>{E.resetFields(),x(e=>({...e,show:!0}))},className:"bg-primary/70 hover:bg-primary text-white font-bold",children:"افزودن کاربر جدید"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(G,{defaultValue:"firstName",className:"w-60",options:[{label:"نام",value:"firstName"},{label:"شماره پرسنلی",value:"personnelId"},{label:"شماره ملی",value:"nationalId"},{label:"کد یگان",value:"unitCode"},{label:"درجه",value:"rank"}]}),s.jsx(H,{className:"w-80",placeholder:"عبارت انتخاب شده را جستجو کنید",prefix:s.jsx(z,{}),onChange:e=>k(e.target.value)})]})]})]})}),c.show&&s.jsx(D,{show:c.show,title:c.title,formValue:c.formValue,onOk:R,onCancel:p}),s.jsx(K,{columns:v(),dataSource:C,pagination:{pageSize:10},scroll:{x:1500}})]})};export{oe as default};
