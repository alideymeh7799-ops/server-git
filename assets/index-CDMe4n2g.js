import{j as e,D as L,E as S,F as B,G as k,B as g,a3 as N,C as I,d as P}from"./index-Bt7t-uRm.js";import{u as U}from"./use-request-B4L2sB-F.js";import{u as C,b as E}from"./user-ReaFp5d6.js";import{r as m}from"./vendor-core-CiUIJZ_7.js";import{e as p,I as D,F as G,f as H,c as V,s as f}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";function K({title:c,show:o,formValue:t,onOk:h,onCancel:l}){const[r]=p.useForm();m.useEffect(()=>{r.setFieldsValue(t)},[t,r]);const x=a=>{h(a,t.id?"edit":"add")};return e.jsx(L,{open:o,onOpenChange:a=>!a&&l(),children:e.jsxs(S,{children:[e.jsx(B,{children:e.jsx(k,{children:c})}),e.jsxs(p,{form:r,layout:"vertical",onFinish:x,initialValues:t,children:[e.jsx(p.Item,{label:"نام",name:"description",rules:[{required:!0,message:"وارد کردن نام الزامی است"},{min:3,message:"نام باید حداقل ۳ کاراکتر باشد"},{max:200,message:"نام باید حداکثر ۲۰۰ کاراکتر باشد"}],children:e.jsx(D,{})}),e.jsx(p.Item,{label:"کد برنامه",name:"code",rules:[{required:!0,message:"کد برنامه الزامی است"},{pattern:/^[0-9]+$/,message:"کد باید فقط شامل عدد باشد"},{min:1,message:"کد باید حداقل ۱ رقم باشد"},{max:10,message:"کد باید حداکثر ۱۰ رقم باشد"}],children:e.jsx(D,{type:"number"})}),e.jsx(p.Item,{shouldUpdate:!0,children:()=>{const a=r.getFieldsError().some(({errors:n})=>n.length>0),i=r.isFieldsTouched(!0);return e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(g,{type:"button",className:"px-5 py-2 rounded-md ml-2 border-gray-300 text-white bg-error/50 hover:bg-error",onClick:l,children:"انصراف"}),e.jsx(g,{type:"submit",disabled:!i||a,className:`px-5 py-2 rounded-md text-white ${!i||a?"bg-gray-400 cursor-not-allowed":"bg-success/70 hover:bg-success"}`,children:t.id?"ویرایش":"افزودن"})]})}})]})]})})}function O({data:c,onEdit:o,onDelete:t}){const{can:h}=C(),{operationList:l,resourceList:r}=N,x=()=>{const a={canEdit:h(r.FAALIAT,l.UPDATE),canDelete:h(r.FAALIAT,l.DELETE)},i=[{title:"نام",dataIndex:"description",key:"description"},{title:"کد فعالیت",dataIndex:"code",key:"code"}],n={title:"عملیات",key:"actions",render:(A,d)=>e.jsxs(H,{children:[a.canEdit&&e.jsx(g,{onClick:()=>o(d),className:"bg-chart3 text-white font-bold hover:bg-primary cursor-pointer ",children:"ویرایش"}),a.canDelete&&e.jsx(V,{title:"آیا مطمئن هستید؟",onConfirm:()=>t(d.id),okText:"بله",cancelText:"خیر",children:e.jsx(g,{className:"bg-error-light hover:bg-error cursor-pointer text-white",children:"حذف"})})]})};return(a.canEdit||a.canDelete)&&i.push(n),i};return e.jsx(G,{dataSource:c,columns:x(),rowKey:"id"})}const q={code:null,description:null};function $(){const{can:c}=C(),{operationList:o,resourceList:t}=N,[h,l]=m.useState(""),[r,x]=m.useState([]),[a,i]=m.useState(Date.now()),[n,A]=m.useState({show:!1,title:"افزودن برنامه جدید",formValue:q}),d=U(),j=d.useGetData(E(t.BARNAME,o.GETALL));m.useEffect(()=>{let s=!0;return s&&c(t.BARNAME,o.GETALL)&&j.fetchData(),()=>{s=!1}},[a]),m.useEffect(()=>{const s=j.data;s?.success&&s.data&&x(s.data)},[j.data]);const M=d.usePostData(E(t.BARNAME,o.CREATE)),T=d.useUpdateData(E(t.BARNAME,o.UPDATE,n?.formValue.id)),v=d.useDeleteData(E(t.BARNAME,o.DELETE)),y=()=>{A(s=>({...s,show:!1}))},w=s=>{A({show:!0,title:"ویرایش برنامه ",formValue:{code:s?.code,id:s?.id,description:s?.description}})},R=async(s,u)=>{let b;u==="add"?b=await M.sendData({code:Number(s.code),description:s.description}):b=await T.sendData({code:Number(s.code),description:s.description}),b&&(i(Date.now()),u==="add"?f.success(" برنامه جدید اضافه شد"):f.info(" برنامه ویرایش شد")),y()},F=async s=>{try{let u;s&&(u=await v.remove("/"+s.toString())),u?.success?(f.success("با موفقیت حذف شد"),i(Date.now())):f.error("خطا در حذف")}catch(u){f.error(u.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}};return e.jsxs(I,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:"مدیریت برنامه ها"}),e.jsxs("div",{className:"flex gap-2",children:[c(t.BARNAME,o.SEARCH)&&e.jsx(D,{placeholder:"جستجو...",value:h,onChange:s=>l(s.target.value),className:"w-60",allowClear:!0}),c(t.BARNAME,o.CREATE)&&e.jsx(g,{className:"text-white bg-primary/95 hover:bg-primary ",onClick:()=>w({code:null,description:null}),children:"افزودن برنامه"})]})]})}),e.jsx(O,{data:r,onEdit:w,onDelete:F}),n.show&&e.jsx(K,{title:n.title,show:n.show,formValue:n.formValue,onOk:R,onCancel:y})]})}const Y=()=>e.jsx($,{});export{Y as default};
