import{a3 as L,j as t,d as P,B as x,e as F,C as I}from"./index-Bt7t-uRm.js";import{u as M}from"./use-request-B4L2sB-F.js";import{u as R,b as u}from"./user-ReaFp5d6.js";import{r as n,j as U}from"./vendor-core-CiUIJZ_7.js";import{e as m,I as E,F as H,M as K,f as q,c as B,s as g}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";const b={code:null,name:null},O=()=>{const{can:r}=R(),{operationList:s,resourceList:o}=L,[y,A]=n.useState([]),[f]=m.useForm(),[C,D]=n.useState(""),[N,j]=n.useState(Date.now()),[i,c]=n.useState({show:!1,title:"افزودن یگان جدید",formValue:b}),d=M(),p=d.useGetData(u(o.YEGAN,s.GETALL)),w=d.useUpdateData(u(o.YEGAN,s.UPDATE,i?.formValue.id),{"content-type":"application/json"}),Y=d.usePostData(u(o.YEGAN,s.CREATE),{"content-type":"application/json"}),T=d.useDeleteData(u(o.YEGAN,s.DELETE),{"content-type":"application/json"});n.useEffect(()=>{r(o.YEGAN,s.GETALL)?p.fetchData():U()(-1)},[N]),n.useEffect(()=>{const e=p.data;e?.success&&e.data&&A(e.data)},[p.data]);const G=()=>{c(e=>({...e,show:!1}))},S=async(e,a)=>{let l;a==="add"?l=await Y.sendData({code:Number(e.code),name:e.name}):l=await w.sendData({code:Number(e.code),name:e.name}),l&&j(Date.now()),G()},v=async e=>{try{let a;e&&(a=await T.remove("/"+e.toString())),a?.success?(g.success("با موفقیت حذف شد"),j(Date.now())):g.error("خطا در حذف")}catch(a){g.error(a.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},V=()=>{const e={canEdit:r(o.YEGAN,s.UPDATE),canDelete:r(o.YEGAN,s.DELETE)},a=[{title:"کد یگان",dataIndex:"code",key:"code"},{title:"نام یگان",dataIndex:"name",key:"name"}],l={title:"عملیات",key:"actions",render:(z,h)=>t.jsxs(q,{children:[e.canEdit&&t.jsx(x,{className:"bg-primary/90 hover:bg-primary text-white cursor-pointer  font-bold",onClick:()=>{f.setFieldsValue(h),c(k=>({show:!0,title:"ویرایش یگان",formValue:{...k.formValue,id:h.id}}))},children:"ویرایش"}),e.canDelete&&t.jsx(B,{title:"آیا مطمئن هستید؟",onConfirm:()=>v(h.id??null),children:t.jsx(x,{className:"bg-error-light hover:bg-error font-bold  cursor-pointer text-white",children:"حذف"})})]})};return(e.canEdit||e.canDelete)&&a.push(l),a};return t.jsxs(t.Fragment,{children:[t.jsxs(P,{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold  text-right w-full sm:w-auto",children:"مدیریت یگان ها"}),t.jsxs("div",{className:"flex items-center gap-2",children:[r(o.YEGAN,s.SEARCH)&&t.jsx(E,{placeholder:"جستجوی کد یا نام یگان",value:C,onChange:e=>D(e.target.value),style:{maxWidth:300}}),r(o.YEGAN,s.CREATE)&&t.jsx(x,{onClick:()=>c(e=>({...e,show:!0})),className:"bg-primary/95 text-white dark:bg-primary",children:"افزودن یگان جدید"})]})]}),t.jsx(F,{children:t.jsx(H,{rowKey:"id",columns:V(),dataSource:y,pagination:{pageSize:5}})}),t.jsx(K,{title:i.title,open:i.show,onCancel:()=>{c(e=>({...e,show:!1,formValue:b}))},onOk:()=>f.submit(),okText:i.formValue.id?"ویرایش":"افزودن",cancelText:"لغو",children:t.jsxs(m,{form:f,layout:"vertical",onFinish:e=>{const a={...e};S(a,i.formValue.id?"edit":"add")},children:[t.jsx(m.Item,{name:"code",label:"کد یگان",rules:[{required:!0,message:"لطفا کد یگان را وارد کنید"},{pattern:/^[0-9]+$/,message:"کد یگان باید فقط شامل عدد باشد"}],children:t.jsx(E,{type:"number"})}),t.jsx(m.Item,{name:"name",label:"نام یگان",rules:[{required:!0,message:"لطفا نام یگان را وارد کنید"},{min:3,max:50,message:"نام یگان باید بین ۳ تا ۵۰ کاراکتر باشد"}],children:t.jsx(E,{})})]})})]})},Z=()=>t.jsx(I,{children:t.jsx(O,{})});export{Z as default};
