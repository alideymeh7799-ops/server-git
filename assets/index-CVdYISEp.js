import{j as e,C as H,d as k,B as j}from"./index-akJh1a2u.js";import{u as K}from"./user-Broof_Gn.js";import{r as n}from"./vendor-core-CiUIJZ_7.js";import{S as _,I as m,F as S,M as D,s as L,f as P}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";function z(){const{can:o}=K(),[r,h]=n.useState(""),[g,b]=n.useState(""),[A,C]=n.useState(""),[v,d]=n.useState(!1),[a,I]=n.useState(null),[c,u]=n.useState(""),[i,p]=n.useState([]),N=()=>{if(!c||!r)return L.error("تمام فیلدها الزامی است");const{hso:t,hsa:s,fmo:l}=a,f=t+s+l,x=Number((f/176).toFixed(2));p(F=>[...F,{...a,extraAmount:Number(c),date:new Date().toLocaleString("fa-IR"),extraDate:r,hours:x}]),d(!1),u(""),h("")},y=t=>{I(t),d(!0)},w=t=>{p(s=>s.filter(l=>l.id!==t))},E=i.reduce((t,s)=>t+s.extraAmount,0),M=()=>{const t={canAdd:o("pre_payment","create")},s=[{title:"نام",dataIndex:"name"},{title:"کد ماخذ HSO",dataIndex:"hso"},{title:"کد ماخذ HSA",dataIndex:"hsa"},{title:"کد ماخذ FMO",dataIndex:"fmo"}],l={title:"عملیات",key:"actions",render:(f,x)=>e.jsx(P,{children:t.canAdd&&e.jsxs(j,{onClick:()=>y(x),className:"bg-error-light text-white",children:["ثبت اضافه کار"," "]})})};return t.canAdd&&s.push(l),s},O=[{title:"نام",dataIndex:"name"},{title:"مبلغ اضافه کار",dataIndex:"extraAmount"},{title:"زمان ثبت",dataIndex:"date"},{title:"HSO",dataIndex:"hso"},{title:"HSA",dataIndex:"hsa"},{title:"FMO",dataIndex:"fmo"},{title:"عملیات",render:(t,s)=>e.jsx(j,{onClick:()=>w(s.id),children:"حذف"})}];return e.jsxs(H,{className:"p-6 space-y-4",children:[e.jsxs(k,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 w-full ",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ثبت اضافه کار"}),e.jsxs("div",{className:"flex gap-3",children:[o("pre_payment","getAll")&&e.jsx(_,{placeholder:"انتخاب یگان",value:g||void 0,onChange:t=>b(t),style:{width:200},options:[{value:"unit1",label:"یگان ۱"},{value:"unit2",label:"یگان ۲"}]}),o("pre_payment","search")&&e.jsx(m,{placeholder:"جستجوی نام",value:A,onChange:t=>C(t.target.value),style:{width:200}})]})]}),e.jsx(S,{dataSource:[],rowKey:"id",columns:M(),pagination:!1}),e.jsxs(D,{title:"ثبت اطلاعات اضافه کار",open:v,onCancel:()=>d(!1),onOk:N,okText:"ثبت",cancelText:"انصراف",children:[e.jsxs("p",{children:["نام پرسنل: ",a?.name]}),e.jsxs("p",{children:["HSO: ",a?.hso," تومان"]}),e.jsxs("p",{children:["HSA: ",a?.hsa," تومان"]}),e.jsxs("p",{children:["FMO: ",a?.fmo," تومان"]}),e.jsxs("p",{children:["مجموع ماخذ:"," ",a?a.hso+a.hsa+a.fmo:0," ","تومان"]}),e.jsxs("p",{children:["تعداد ساعت:"," ",a?((a.hso+a.hsa+a.fmo)/176).toFixed(2):"0"]}),e.jsx(m,{className:"mt-2",placeholder:"مبلغ اضافه کار",value:c,onChange:t=>u(t.target.value),type:"number"}),e.jsx(m,{className:"mt-2",placeholder:"تاریخ اضافه کار (مثلاً 1403/05/15)",value:r,onChange:t=>h(t.target.value)})]}),i.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"لیست اضافه‌کار ثبت شده"}),e.jsx(S,{dataSource:i,rowKey:"id",columns:O,pagination:!1,footer:()=>e.jsxs("div",{className:"text-right font-bold",children:["مجموع کل مبلغ: ",E.toLocaleString()," تومان"]})})]})]})}function q(){return e.jsx(z,{})}export{q as default};
