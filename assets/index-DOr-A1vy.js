import{u as Q,i as G,j as e,D as Ce,E as Ne,F as ve,G as ye,H as Te,B as w,a3 as U,I as R,O as we,Q as Ae,R as Ie,U as Se,s as te,e as K,C as V,d as Y}from"./index-akJh1a2u.js";import{u as Le}from"./use-request-D0F366jR.js";import{r as n,j as ke}from"./vendor-core-CiUIJZ_7.js";import{C as Re}from"./credit-budget-add-payment-CxiqD7Kw.js";import{F as Be,a as A,b as I,e as S,c as L}from"./form-Cjy9Qfuo.js";import{I as B}from"./input-DybMe5F1.js";import{u as Ge}from"./index.esm-BGUB25Qb.js";import{u as F,b as N}from"./user-Broof_Gn.js";import"./vendor-utils-IiNHtr66.js";import{F as ae,b as Ue,c as Fe,d as Me,I as Pe,S as se,s as v}from"./vendor-ui-DnFwFa5O.js";import{c as ze}from"./converted-time-Dpp4WfBk.js";import"./persian-OLrIT8M7.js";import"./index-CkzAM18b.js";function qe({title:r,show:d,formValue:s,onOk:m,onCancel:i,dataFaaliat:h,dataBarname:f}){const{locale:x}=Q(),{t:b}=G(),a=Ge({defaultValues:s,mode:"onChange"}),[E,l]=n.useState(s.barname_id),[_,D]=n.useState(s.faaliat_id);n.useEffect(()=>{a.reset(s),l(s.barname_id),D(s.faaliat_id)},[s,a]);const y=c=>{if(!E){a.setError("barname_id",{type:"required",message:"انتخاب برنامه الزامی است"});return}if(!_){a.setError("faaliat_id",{type:"required",message:"انتخاب فعالیت الزامی است"});return}m({...c,faaliat_id:_,barname_id:E},s.id?"edit":"add")},u=a.formState.isValid&&E!==void 0&&_!==void 0;return e.jsx(Ce,{open:d,onOpenChange:c=>!c&&i(),children:e.jsxs(Ne,{children:[e.jsx(ve,{children:e.jsx(ye,{children:r})}),e.jsx(Be,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(y),className:"space-y-4",style:{direction:x==="fa_IR"?"rtl":"ltr"},children:[e.jsx(A,{control:a.control,name:"radif",rules:{required:"ردیف الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{children:[e.jsx(S,{children:b("credits.credit_budget_origin.culoumns_header.radif")}),e.jsx(L,{children:e.jsx(B,{...c,value:c.value||""})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsx(A,{control:a.control,name:"noe_etebar",rules:{required:"نوع اعتبار الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{children:[e.jsx(S,{children:"نوع اعتبار"}),e.jsx(L,{children:e.jsx(B,{...c,value:c.value||""})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsx(A,{control:a.control,name:"barname_id",rules:{required:"انتخاب برنامه الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{className:"flex flex-col gap-2",children:[e.jsx(S,{children:"انتخاب برنامه"}),e.jsx(L,{children:e.jsxs("select",{...c,className:"w-full px-2 py-1 border border-accent rounded-b-md",value:E??"",onChange:p=>{const T=Number(p.target.value);l(T),c.onChange(T)},children:[e.jsx("option",{value:"",disabled:!0,className:"bg-background",children:"انتخاب کنید"}),f.map(p=>e.jsx("option",{value:p.id,className:"bg-background",children:p.code+"  "+p.description},p.id))]})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsx(A,{control:a.control,name:"faaliat_id",rules:{required:"انتخاب فعالیت الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{className:"flex flex-col gap-2",children:[e.jsx(S,{children:"انتخاب فعالیت"}),e.jsx(L,{children:e.jsxs("select",{...c,className:"w-full px-2 py-1 border border-accent rounded-b-md",value:_??"",onChange:p=>{const T=Number(p.target.value);D(T),c.onChange(T)},children:[e.jsx("option",{value:"",disabled:!0,className:"bg-background",children:"انتخاب کنید"}),h.map(p=>e.jsx("option",{value:p.id,className:"bg-background",children:p.code+"  "+p.description},p.id))]})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsx(A,{control:a.control,name:"madeh",rules:{required:"ماده الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{children:[e.jsx(S,{children:b("credits.credit_budget_origin.culoumns_header.madeh")}),e.jsx(L,{children:e.jsx(B,{...c,value:c.value||""})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsx(A,{control:a.control,name:"payment_description",rules:{required:"توضیحات هزینه الزامی است"},render:({field:c,fieldState:g})=>e.jsxs(I,{children:[e.jsx(S,{children:b("credits.credit_budget_origin.culoumns_header.sharh_hazineh")}),e.jsx(L,{children:e.jsx(B,{...c,value:c.value||""})}),g.error&&e.jsx("p",{className:"text-red-500 text-sm",children:g.error.message})]})}),e.jsxs(Te,{children:[e.jsx(w,{variant:"outline",className:"bg-error/80 hover:bg-error text-white font-bold",onClick:i,children:b("buttons.cansel")}),e.jsx(w,{type:"submit",className:"text-common-white",variant:"default",disabled:!u,children:s.id?b("buttons.edit"):b("buttons.add")})]})]})})]})})}const Oe=r=>[{id:2,title:r("credits.credit_budget_origin.culoumns_header.radif"),value:"radif"},{id:0,title:r("credits.credit_budget_origin.culoumns_header.program"),value:"program"},{id:1,title:r("credits.credit_budget_origin.culoumns_header.faliat"),value:"faliat"},{id:3,title:r("credits.credit_budget_origin.culoumns_header.madeh"),value:"madeh"},{id:4,title:r("credits.credit_budget_origin.culoumns_header.sharhe_program"),value:"sharhe_program"},{id:5,title:r("credits.credit_budget_origin.culoumns_header.sharh_faliat"),value:"sharh_faliat"},{id:6,title:r("credits.credit_budget_origin.culoumns_header.sharh_hazineh"),value:"sharh_hazineh"}],He=({record:r,onRefresh:d,onEdit:s,openCreateModalCredit:m})=>{const i=F(),{operationList:h,resourceList:f}=U,[x,b]=n.useState(!1),a=()=>{te.warning("آیا از حذف  مطمئن هستید؟",{action:{label:"حذف",onClick:async()=>{d()}},cancel:{label:"لغو",onClick:()=>{}}})},l=[{key:"edit",label:e.jsxs("div",{className:"flex items-center text-gray",children:[e.jsx(R,{icon:"solar:pen-bold"}),e.jsx("span",{className:"ml-2",children:"ویرایش"})]}),action:()=>s(r),permission:i.can(f.CREDITBUDGET,h.UPDATE)},{key:"addCredit",label:e.jsxs("div",{className:"flex items-center text-gray",children:[e.jsx(R,{icon:"solar:wallet-bold"}),e.jsx("span",{className:"ml-2",children:"افزودن اعتبار"})]}),action:m,permission:i.can(f.CREDITBUDGET,h.CREATE)},{key:"delete",label:e.jsxs("div",{className:"flex items-center text-warning",children:[e.jsx(R,{icon:"solar:trash-bin-trash-bold"}),e.jsx("span",{className:"ml-2",children:"حذف"})]}),action:a,permission:i.can(f.CREDITBUDGET,h.DELETE)}].filter(_=>_.permission);return e.jsxs(we,{open:x,onOpenChange:b,children:[e.jsx(Ae,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"text-gray! ",children:e.jsx(R,{icon:"dashicons:ellipsis"})})}),e.jsx(Ie,{align:"end",children:l.map(_=>e.jsx(Se,{onClick:D=>{D.stopPropagation(),b(!1),_.action()},children:_.label},_.key))})]})};function Ke({onEdit:r,data:d,openCreateModalCredit:s,selectedRow:m,showDataCredits:i}){const h=F(),{operationList:f,resourceList:x}=U,{locale:b}=Q(),{t:a}=G(),E=()=>{const l={canEdit:h.can(x.CREDITBUDGET,f.UPDATE),canDelete:h.can(x.CREDITBUDGET,f.DELETE)},_=[{title:a("credits.credit_budget_origin.culoumns_header.radif"),dataIndex:"radif",key:"radif"},{title:a("credits.credit_budget_origin.culoumns_header.program"),key:"barname",render:(y,u)=>u.barname?.code??"-"},{title:a("credits.credit_budget_origin.culoumns_header.faliat"),key:"faaliat",render:(y,u)=>u.faaliat?.code??"-"},{title:a("credits.credit_budget_origin.culoumns_header.madeh"),dataIndex:"madeh",key:"madeh"},{title:a("credits.credit_budget_origin.culoumns_header.sharh_hazineh"),dataIndex:"payment_description",key:"payment_description"},{title:a("credits.credit_budget_origin.culoumns_header.sharhe_program"),key:"sharhe_program",render:(y,u)=>u.barname?.code??"-"},{title:a("credits.credit_budget_origin.culoumns_header.sharh_faliat"),key:"sharh_faliat",render:(y,u)=>u.faaliat?.code??"-"},{title:a("credits.credit_budget_origin.culoumns_header.noeEtebar"),dataIndex:"noe_etebar",key:"noe_etebar"}],D={title:"عملیات",key:"actions",render:(y,u)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(He,{record:u,onRefresh:()=>{},openCreateModalCredit:()=>s(null,u.id?u.id:null),onEdit:()=>r(u)}),(h.can(x.CREDITBUDGET,f.UPDATE)||h.can(x.CREDITBUDGET,f.CREATE))&&e.jsx(w,{className:u?.id===m?.id?"bg-error-dark hover:bg-error text-white py-1 px-2 text-xs cursor-pointer":"bg-chart3 hover:bg-chart3/80 text-white border py-1 px-2 text-xs cursor-pointer",onClick:()=>i(u?.id===m?.id?null:u),children:u?.id===m?.id?"بستن اعتبارات":a("credits.credit_budget_origin.show_data_budgets")})]})};return(l.canEdit||l.canDelete)&&_.push(D),_};return e.jsx(K,{className:"w-full",children:e.jsx(ae,{columns:E(),dataSource:d,rowKey:"id",style:{direction:b==="fa_IR"?"rtl":"ltr"},className:"max-w-full ",rowClassName:l=>l?.id===m?.id?"bg-accent-foreground/20":""})})}const Ve=({selectedRecord:r,dataSelected:d,openCreateModalCredit:s,onDelete:m})=>{const{t:i}=G(),{can:h}=F(),{operationList:f,resourceList:x}=U,[b,a]=n.useState(0);n.useEffect(()=>{const l=d.reduce((_,D)=>_+(D.amount_etebar||0),0);a(l)},[d]);const E=l=>{te.warning("آیا از حذف  مطمئن هستید؟",{action:{label:"حذف",onClick:()=>{l.id&&m(l.id,"credit")}},cancel:{label:"لغو",onClick:()=>{}}})};return e.jsx("section",{className:"w-full px-4",children:e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs(V,{className:"bg-background shadow-sm",children:[e.jsx(Y,{children:e.jsx("div",{className:"text-lg font-semibold",children:i("credits.credit_budget_origin.credit_budget_origin_selcted")})}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.radif"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.radif})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.program"),":"," "]}),e.jsxs("span",{className:"text-primary",children:[" ",r.barname?.description]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.faliat"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.faaliat?.code})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.madeh"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.madeh})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.sharh_hazineh"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.payment_description})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.sharhe_program"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.barname?.description})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.sharh_faliat"),":"," "]}),e.jsx("span",{className:"text-primary",children:r.faaliat?.description})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:" نوع اعتبار : "}),e.jsx("span",{className:"text-primary",children:r.noe_etebar})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[" ",i("credits.credit_budget_origin.culoumns_header.kol"),":"," "]}),e.jsxs("span",{className:"text-primary",children:[Number(b).toLocaleString(),"  ريال"]})]})]})})]}),e.jsxs(V,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"text-lg font-semibold",children:[i("credits.credit_budget_origin.credit_budget_origin_selcted_title")," "]})}),e.jsx(K,{children:e.jsx(ae,{rowKey:"id",columns:[{title:"شماره برگ اعتبار",dataIndex:"number_etebar"},{title:"تاریخ برگ اعتبار",dataIndex:"date_etebar",render:l=>ze(l,"date")},{title:i("non_credits.mablagh"),dataIndex:"amount_etebar",render:l=>l.toLocaleString("fa-IR")},{title:"  یگان واگذار ",dataIndex:"yegan_vagozar_id"},{title:i("non_credits.actions"),render:(l,_)=>e.jsxs("div",{className:"flex gap-2",children:[h(x.CREDITBUDGET,f.UPDATE)&&e.jsxs(w,{onClick:()=>s(_,r.id?r.id:null),className:"flex items-center cursor-pointer justify-center px-4 py-1 text-sm font-medium font-iransans bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",children:[e.jsx(Ue,{}),i("buttons.edit")]}),h(x.CREDITBUDGET,f.DELETE)&&e.jsx(Fe,{title:i("buttons.confirm_deleted_item_messages"),okText:i("buttons.okText"),cancelText:i("buttons.cancelText"),placement:"topRight",children:e.jsxs(w,{onClick:()=>E(_),className:"flex cursor-pointer items-center justify-center px-4 py-1 text-sm font-medium font-iransans bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors",children:[e.jsx(Me,{}),i("buttons.delete")]})})]})}],dataSource:d,pagination:!1,size:"small"})})]})]})})},{Option:Ye}=se,ee={radif:null,program:null,madeh:null,payment_description:null,faliat:null,sharh_faliat:null,sharh_hazineh:null,sharhe_program:null};function Qe(){const{can:r}=F(),{operationList:d,resourceList:s}=U,{t:m}=G(),{locale:i}=Q(),[h,f]=n.useState({faliat:"",madeh:"",payment_description:"",program:"",radif:null,sharh_faliat:"",sharh_hazineh:"",sharhe_program:""}),[x,b]=n.useState({show:!1,title:m("credits.credit_budget_origin.title_modal_add"),formValue:ee}),[a,E]=n.useState({show:!1,title:m("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:null,date_etebar:new Date().toLocaleString(),amount_etebar:null,assigningUnit:null}}),[l,_]=n.useState("radif"),[D,y]=n.useState(""),[u,c]=n.useState([]),[g,p]=n.useState([]),T=()=>{b({show:!0,title:m("credits.credit_budget_origin.title_modal_add"),formValue:ee})},$=(t,o)=>{t?.amount_etebar?E({show:!0,title:"ویرایش برگ اعتبار",formValue:{number_etebar:t.number_etebar,date_etebar:t.date_etebar??"",amount_etebar:t.amount_etebar??null,assigningUnit:t.assigningUnit??null},id:o}):E({show:!0,title:m("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:null,date_etebar:"",amount_etebar:null,assigningUnit:null},id:o})},re=t=>{b({show:!0,title:m("credits.credit_budget_origin.title_modal_edit"),formValue:t})},J=()=>{b(t=>({...t,show:!1}))},W=()=>{E(t=>({...t,show:!1}))},ie=n.useMemo(()=>u.filter(t=>{const o=t[l];return o==null?!1:o.toString().toLowerCase().includes(D.toLowerCase())}),[u,D,l]),[X,Z]=n.useState(Date.now()),[ne,M]=n.useState(Date.now()),[de,oe]=n.useState({yegan:[]}),C=Le(),P=C.useGetData("api/getMany?resources="+s.YEGAN);n.useEffect(()=>{r(s.YEGAN,d.GETALL)&&P.fetchData()},[]),n.useEffect(()=>{const t=P.data;t?.success&&t.data&&oe({yegan:t.data[s.YEGAN]})},[P.data]);const z=C.useGetData(N(s.CREDITBUDGET,d.GETALL)),k=C.useGetData(N(s.ADDCREDITS,d.GETALL)),[le,ce]=n.useState([]),[ue,me]=n.useState([]),q=C.useGetData(N(s.FAALIAT,d.GETALL)),O=C.useGetData(N(s.BARNAME,d.GETALL));n.useEffect(()=>{let t=!0;return t&&r(s.FAALIAT,d.GETALL)&&(q.fetchData(),O.fetchData()),()=>{t=!1}},[X]),n.useEffect(()=>{const t=q.data,o=O.data;t?.success&&t.data&&me(t.data),o?.success&&o.data&&ce(o.data)},[q.data,O.data]);const he=C.useUpdateData(N(s.CREDITBUDGET,d.UPDATE,x.formValue.id)),_e=C.usePostData(N(s.CREDITBUDGET,d.CREATE)),ge=C.usePostData(N(s.ADDCREDITS,d.CREATE)),xe=C.useUpdateData(N(s.ADDCREDITS,d.UPDATE,a.id)),be=C.useDeleteData(N(s.CREDITBUDGET,d.DELETE)),fe=C.useDeleteData(N(s.ADDCREDITS,d.DELETE));n.useEffect(()=>{r(s.CREDITBUDGET,d.GETALL)?z.fetchData():ke()(-1)},[X]),n.useEffect(()=>{const t=z.data;t?.success&&t.data&&c(t.data)},[z.data]),n.useEffect(()=>{h?.id&&k.fetchData()},[ne]),n.useEffect(()=>{if(k.data?.data){const t=k.data?.data||[],o=[];t.forEach(j=>{j.credit_budget_id&&j.credit_budget_id===h.id&&o.push(j)}),p(o)}},[k.data?.data]);const pe=async t=>{f(t),M(Date.now())},je=async(t,o)=>{let j;o==="add"?j=await _e.sendData({barname_id:Number(t.barname_id),faaliat_id:Number(t.faaliat_id),radif:t.radif,madeh:t.madeh,noe_etebar:t.noe_etebar,payment_description:t.payment_description}):j=await he.sendData({barname_id:Number(t.barname_id),faaliat_id:Number(t.faaliat_id),radif:t.radif,madeh:t.madeh,noe_etebar:t.noe_etebar,payment_description:t.payment_description}),j?(Z(Date.now()),o==="add"?v.success("با موفقیت اضافه  شد"):v.info("با موفقیت ویرایش شد")):v.error("خطا در ارسال اطلاعات"),J()},Ee=async(t,o)=>{const j=t.date_etebar?new Date(t.date_etebar).toISOString():null;let H;o==="add"?H=await ge.sendData({number_etebar:t.number_etebar,yegan_vagozar_id:t.yegan_vagozar_id,amount_etebar:Number(t.amount_etebar),date_etebar:j,credit_budget_id:a.id}):H=await xe.sendData({number_etebar:t.number_etebar,yegan_vagozar_id:t.yegan_vagozar_id,amount_etebar:Number(t.amount_etebar),date_etebar:j,credit_budget_id:a.id}),H?(M(Date.now()),o==="add"?v.success("با موفقیت اضافه  شد"):v.info("با موفقیت ویرایش شد")):v.error("خطا در ارسال اطلاعات"),W()},De=async(t,o="budget")=>{try{let j;j=o==="budget"?await be.remove("/"+t.toString()):await fe.remove("/"+t.toString()),j?.success?(v.success("با موفقیت حذف شد"),o==="budget"?Z(Date.now()):M(Date.now())):v.error("خطا در حذف")}catch(j){v.error(j.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 w-full ",style:{direction:i==="fa_IR"?"rtl":"ltr"},children:[e.jsx("div",{className:"text-lg font-semibold text-right w-full sm:w-auto",children:m("credits.credit_budget_origin.title_page")}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto",children:[r(s.CREDITBUDGET,d.SEARCH)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center border p-3 rounded-md bg-card text-card-foreground  w-full sm:w-auto",children:[e.jsx("div",{className:"flex gap-1 items-center justify-start",children:e.jsx(Pe,{placeholder:m("credits.credit_budget_origin.search_placeholder"),value:D,onChange:t=>y(t.target.value),allowClear:!0,className:"w-full sm:w-52"})}),e.jsx(se,{value:l,onChange:t=>_(t),className:"w-48",children:Oe(m).map((t,o)=>e.jsx(Ye,{value:t.value,children:t.title},o))})]}),r(s.CREDITBUDGET,d.CREATE)&&e.jsx(w,{onClick:T,className:"w-full sm:w-auto cursor-pointer whitespace-nowrap text-common-white",children:m("credits.credit_budget_origin.button_add_creadits_origin")})]})]})}),e.jsx(Ke,{onEdit:re,data:ie,openCreateModalCredit:$,showDataCredits:pe,selectedRow:h}),h&&h.id&&e.jsx(Ve,{dataSelected:g,selectedRecord:h,openCreateModalCredit:$,onDelete:De}),x.show&&e.jsx(qe,{title:x.title,show:x.show,formValue:x.formValue,onOk:je,onCancel:J,dataBarname:le,dataFaaliat:ue}),a.show&&e.jsx(Re,{title:a.title,show:a.show,formValue:a.formValue,onOk:Ee,onCancel:W,dataYegan:de.yegan})]})}function ot(){return e.jsx(V,{children:e.jsx(Qe,{})})}export{ot as default};
