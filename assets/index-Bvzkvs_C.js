import{j as t,C as I,d as M,e as v}from"./index-akJh1a2u.js";import{u as N,A as i}from"./use-request-D0F366jR.js";import{r as s}from"./vendor-core-CiUIJZ_7.js";import{e as c,I as m,B as p,F as T,M as E,f as A,c as K,s as f}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";const h={code:null,name:null},U=()=>{const[j,y]=s.useState([]),[d]=c.useForm(),[g,w]=s.useState(""),[C,x]=s.useState(Date.now()),[o,r]=s.useState({show:!1,title:"افزودن یگان جدید",formValue:h}),l=N(),u=l.useGetData("api/yegan",{Authorization:i}),D=l.useUpdateData("api/yegan/"+o?.formValue.id,{"content-type":"application/json",Authorization:i}),b=l.usePostData("api/yegan",{"content-type":"application/json",Authorization:i}),S=l.useDeleteData("api/yegan/",{"content-type":"application/json",Authorization:i});s.useEffect(()=>{u.fetchData()},[C]),s.useEffect(()=>{const e=u.data;e?.success&&e.data&&y(e.data)},[u.data]);const k=()=>{r(e=>({...e,show:!1}))},P=async(e,a)=>{let n;a==="add"?n=await b.sendData({code:Number(e.code),name:e.name}):n=await D.sendData({code:Number(e.code),name:e.name}),n&&x(Date.now()),k()},V=async e=>{try{let a;e&&(a=await S.remove(e.toString())),a?.success?(f.success("با موفقیت حذف شد"),x(Date.now())):f.error("خطا در حذف")}catch(a){f.error(a.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},F=[{title:"کد یگان",dataIndex:"code",key:"code"},{title:"نام یگان",dataIndex:"name",key:"name"},{title:"عملیات",key:"actions",render:(e,a)=>t.jsxs(A,{children:[t.jsx(p,{type:"link",onClick:()=>{d.setFieldsValue(a),r(n=>({...n,show:!0,title:"ویرایش یگان"}))},children:"ویرایش"}),t.jsx(K,{title:"آیا مطمئن هستید؟",onConfirm:()=>V(a.id?a.id:null),children:t.jsx(p,{type:"link",danger:!0,children:"حذف"})})]})}];return t.jsxs(I,{children:[t.jsxs(M,{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold  text-right w-full sm:w-auto",children:"مدیریت یگان ها"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(m,{placeholder:"جستجوی کد یا نام یگان",value:g,onChange:e=>w(e.target.value),style:{maxWidth:300}}),t.jsx(p,{type:"primary",onClick:()=>r(e=>({...e,show:!0})),children:"افزودن یگان جدید"})]})]}),t.jsx(v,{children:t.jsx(T,{rowKey:"id",columns:F,dataSource:j,pagination:{pageSize:5}})}),t.jsx(E,{title:o.title,open:o.show,onCancel:()=>{r(e=>({...e,show:!1,formValue:h}))},onOk:()=>d.submit(),okText:o.formValue.id?"ویرایش ":"افزودن",cancelText:"لغو",children:t.jsxs(c,{form:d,layout:"vertical",onFinish:e=>{const a={...e};P(a,o.formValue.id?"edit":"add")},children:[t.jsx(c.Item,{name:"code",label:"کد یگان",rules:[{required:!0}],children:t.jsx(m,{type:"number"})}),t.jsx(c.Item,{name:"name",label:"نام یگان",rules:[{required:!0}],children:t.jsx(m,{})})]})})]})};export{U as default};
