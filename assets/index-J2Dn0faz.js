import{a3 as v,j as t,d as Z,B as A,e as k,C as L}from"./index-Bt7t-uRm.js";import{u as P}from"./use-request-B4L2sB-F.js";import{u as F,b as u}from"./user-ReaFp5d6.js";import{r,j as M}from"./vendor-core-CiUIJZ_7.js";import{e as m,I as p,F as I,M as U,f as z,c as H,s as E}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";const j={code:null,name:null},K=()=>{const{can:n}=F(),{operationList:s,resourceList:o}=v,[b,G]=r.useState([]),[f]=m.useForm(),[V,C]=r.useState(""),[D,g]=r.useState(Date.now()),[l,c]=r.useState({show:!1,title:"افزودن یگان واگذار جدید",formValue:j}),d=P(),h=d.useGetData(u(o.YEGANVAGOZAR,s.GETALL)),N=d.useUpdateData(u(o.YEGANVAGOZAR,s.UPDATE,l?.formValue.id)),w=d.usePostData(u(o.YEGANVAGOZAR,s.CREATE)),y=d.useDeleteData(u(o.YEGANVAGOZAR,s.DELETE));r.useEffect(()=>{n(o.YEGANVAGOZAR,s.GETALL)?h.fetchData():M()(-1)},[D]),r.useEffect(()=>{const e=h.data;e?.success&&e.data&&G(e.data)},[h.data]);const R=()=>{c(e=>({...e,show:!1}))},Y=async(e,a)=>{let i;a==="add"?i=await w.sendData({code:Number(e.code),name:e.name}):i=await N.sendData({code:Number(e.code),name:e.name}),i&&g(Date.now()),R()},T=async e=>{try{let a;e&&(a=await y.remove("/"+e.toString())),a?.success?(E.success("با موفقیت حذف شد"),g(Date.now())):E.error("خطا در حذف")}catch(a){E.error(a.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},S=()=>{const e={canEdit:n(o.YEGANVAGOZAR,s.UPDATE),canDelete:n(o.YEGANVAGOZAR,s.DELETE)},a=[{title:"نام یگان",dataIndex:"name",key:"name"}],i={title:"عملیات",key:"actions",render:(q,x)=>t.jsxs(z,{children:[e.canEdit&&t.jsx(A,{className:"bg-primary/90 hover:bg-primary text-white cursor-pointer  font-bold",onClick:()=>{f.setFieldsValue(x),c(O=>({show:!0,title:"ویرایش یگان واگذار",formValue:{...O.formValue,id:x.id}}))},children:"ویرایش"}),e.canDelete&&t.jsx(H,{title:"آیا مطمئن هستید؟",onConfirm:()=>T(x.id??null),children:t.jsx(A,{className:"bg-error-light hover:bg-error font-bold  cursor-pointer text-white",children:"حذف"})})]})};return(e.canEdit||e.canDelete)&&a.push(i),a};return t.jsxs(t.Fragment,{children:[t.jsxs(Z,{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold  text-right w-full sm:w-auto",children:"مدیریت یگان های واگذار شده"}),t.jsxs("div",{className:"flex items-center gap-2",children:[n(o.YEGANVAGOZAR,s.SEARCH)&&t.jsx(p,{placeholder:"جستجوی کد یا نام یگان",value:V,onChange:e=>C(e.target.value),style:{maxWidth:300}}),n(o.YEGANVAGOZAR,s.CREATE)&&t.jsx(A,{onClick:()=>c(e=>({...e,show:!0})),className:"bg-primary/95 text-white dark:bg-primary",children:"افزودن یگان جدید"})]})]}),t.jsx(k,{children:t.jsx(I,{rowKey:"id",columns:S(),dataSource:b,pagination:{pageSize:5}})}),t.jsx(U,{title:l.title,open:l.show,onCancel:()=>{c(e=>({...e,show:!1,formValue:j}))},onOk:()=>f.submit(),okText:l.formValue.id?"ویرایش ":"افزودن",cancelText:"لغو",children:t.jsxs(m,{form:f,layout:"vertical",onFinish:e=>{const a={...e};Y(a,l.formValue.id?"edit":"add")},children:[t.jsx(m.Item,{name:"code",label:"کد یگان",rules:[{required:!0,message:"لطفا کد یگان را وارد کنید"}],children:t.jsx(p,{type:"number"})}),t.jsx(m.Item,{name:"name",label:"نام یگان",rules:[{required:!0,message:"لطفا نام یگان را وارد کنید"},{min:3,max:50,message:"نام یگان باید بین ۳ تا ۵۰ کاراکتر باشد"}],children:t.jsx(p,{})})]})})]})},$=()=>t.jsx(L,{children:t.jsx(K,{})});export{$ as default};
