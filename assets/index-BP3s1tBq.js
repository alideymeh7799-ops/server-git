import{i as W,j as o,C as X,d as Y,B as Z}from"./index-akJh1a2u.js";import{r as s}from"./vendor-core-CiUIJZ_7.js";import{d as $,C as ee}from"./credit-budget-table-BLFGZnUB.js";import{u as te,A as i}from"./use-request-D0F366jR.js";import ae from"./credit-budget-add-payment-CLT4UzdC.js";import oe from"./credit-budget-modal-Bxb6h0q_.js";import se from"./show-data-selected-recorded-DkDSXP70.js";import{I as re,S as N,s as w}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";import"./index-C7VwecpD.js";import"./table-actions-BNmnGYNN.js";import"./form-Cjy9Qfuo.js";import"./index.esm-BGUB25Qb.js";import"./input-DybMe5F1.js";import"./persian-OLrIT8M7.js";import"./index-CkzAM18b.js";import"./converted-time-Dpp4WfBk.js";const{Option:ne}=N,z={sarfasl:"",payment_description:"",mojavez:"",credit_origin:""};function je(){const{t:r}=W(),[l,m]=s.useState({show:!1,title:r("non_credits.title_modal_add_payment"),formValue:z}),[c,C]=s.useState({mojavez:"",credit_origin:"",payment_description:"",sarfasl:""}),[d,_]=s.useState({show:!1,title:r("non_credits.title_modal_add_payment"),formValue:{number_etebar:null,date_etebar:new Date().toLocaleString(),amount_etebar:null,assigningUnit:null}}),[p,B]=s.useState("sarfasl"),[f,V]=s.useState(""),[y,x]=s.useState([]),[E,P]=s.useState([]),[R,S]=s.useState(Date.now()),[U,g]=s.useState(Date.now()),n=te(),b=n.useGetData("api/credit-origin-nonbudget",{Authorization:i}),u=n.useGetData("api/addcredit",{Authorization:i}),A=n.usePostData("api/credit-origin-nonbudget",{"content-type":"application/json",Authorization:i}),k=n.usePostData("api/addcredit",{"content-type":"application/json",Authorization:i}),K=n.useUpdateData("api/credit-origin-nonbudget/"+l.formValue.id,{"content-type":"application/json",Authorization:i}),L=n.useUpdateData("api/addcredit/"+d.id,{"content-type":"application/json",Authorization:i}),O=n.useDeleteData("api/credit-origin-nonbudget/",{"content-type":"application/json",Authorization:i}),F=n.useDeleteData("api/addcredit/",{"content-type":"application/json",Authorization:i});s.useEffect(()=>{b.fetchData()},[R]),s.useEffect(()=>{const e=b.data;e?.success&&e.data&&x(e.data)},[b.data]);const H=()=>{m({show:!0,title:r("non_credits.title_modal_add_payment"),formValue:z})},I=e=>{m({show:!0,title:r("non_credits.title_modal_edit_payment"),formValue:e})},j=()=>{m(e=>({...e,show:!1}))},T=async(e,t)=>{let a;t==="add"?a=await A.sendData({credit_origin:e.credit_origin,payment_description:e.payment_description,sarfasl:e.sarfasl,mojavez:e.mojavez}):a=await K.sendData({credit_origin:e.credit_origin,payment_description:e.payment_description,sarfasl:e.sarfasl,mojavez:e.mojavez}),a&&S(Date.now()),j()},D=async(e,t="budget")=>{try{let a;a=t==="budget"?await O.remove(e.toString()):await F.remove(e.toString()),a?.success?(w.success("با موفقیت حذف شد"),t==="budget"?S(Date.now()):g(Date.now())):w.error("خطا در حذف")}catch(a){w.error(a.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},v=(e,t)=>{e?.amount_etebar?_({show:!0,title:r("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:e.number_etebar,date_etebar:e.date_etebar??new Date().toLocaleString(),amount_etebar:e.amount_etebar??null,assigningUnit:e.assigningUnit??null,yegan_vagozar_id:e.yegan_vagozar_id},id:t}):_({show:!0,title:r("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:null,date_etebar:new Date().toString(),amount_etebar:null,assigningUnit:null,yegan_vagozar_id:void 0},id:t})},M=()=>{_(e=>({...e,show:!1}))},q=async(e,t)=>{const a=e.date_etebar?new Date(e.date_etebar).toISOString():null;let h;t==="add"?h=await k.sendData({number_etebar:e.number_etebar,yegan_vagozar_id:2,amount_etebar:Number(e.amount_etebar),date_etebar:a,credit_non_budget_id:d.id}):h=await L.sendData({number_etebar:e.number_etebar,yegan_vagozar_id:2,amount_etebar:Number(e.amount_etebar),date_etebar:a,credit_non_budget_id:d.id}),h&&g(Date.now()),M()},G=e=>{C(e)};s.useEffect(()=>{c?.id&&u.fetchData()},[U]),s.useEffect(()=>{if(u.data?.data){const e=u.data?.data||[],t=[];e.forEach(a=>{a.credit_non_budget_id&&a.credit_non_budget_id===c.id&&t.push(a)}),P(t)}},[u.data?.data]);const Q=async e=>{C(e),g(Date.now())},J=s.useMemo(()=>y.filter(e=>{const t=e[p];return t==null?!1:t.toString().toLowerCase().includes(f.toLowerCase())}),[y,f,p]);return o.jsxs(X,{children:[o.jsx(Y,{children:o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 w-full",children:[o.jsx("div",{className:"text-lg font-semibold text-right w-full sm:w-auto",children:r("non_credits.title_page")}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center border p-3 rounded-md bg-card text-card-foreground  w-full sm:w-auto",children:[o.jsx(re,{placeholder:r("non_credits.search_placeholder"),value:f,onChange:e=>V(e.target.value),allowClear:!0,className:"w-full sm:w-52"}),o.jsx(N,{value:p,onChange:e=>B(e),className:"w-full sm:w-56",children:$(r).map((e,t)=>o.jsx(ne,{value:e.value,children:e.title},t))})]}),o.jsx(Z,{onClick:H,className:"w-full sm:w-auto  bg-chart1 text-common-white font-bold whitespace-nowrap",children:r("non_credits.button_add")})]})]})}),o.jsx(ee,{onEdit:I,setData:x,onDelete:D,data:J,openCreateModalCredit:v,showCreditModal:G,showDataCredits:Q}),c.id&&o.jsx(se,{dataSelected:E,selectedRecord:c,openCreateModalCredit:v,onDelete:D}),l.show&&o.jsx(oe,{title:l.title,show:l.show,formValue:l.formValue,onOk:T,onCancel:j}),d.show&&o.jsx(ae,{title:d.title,show:d.show,formValue:d.formValue,onOk:q,onCancel:M})]})}export{je as default};
