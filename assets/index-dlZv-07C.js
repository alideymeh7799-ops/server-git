import{q as n,j as u,f as K,B as M,I as z,r as B}from"./index-akJh1a2u.js";import"./vendor-utils-IiNHtr66.js";import{I as L}from"./input-DybMe5F1.js";import{u as R,a as W,D as q,S as U,h as V,b as F,K as J,c as y,P as Q}from"./kanban-task-qbIgSnRs.js";import{r as p}from"./vendor-core-CiUIJZ_7.js";import{u as X,K as T}from"./kanban-column-BSWvZs3M.js";import{T as f,a as Y}from"./task-detail-BkBMVkij.js";import"./vendor-ui-DnFwFa5O.js";import"./avatar-CWLePwK0.js";import"./select-jzxhk6QA.js";import"./check-CYoWhRsC.js";import"./textarea-CpYHWTAr.js";import"./toggle-group-Pp2bMhhz.js";const g=t=>{const o=[];for(let r=0;r<t;r+=1)o.push({username:n.person.fullName(),avatar:n.image.avatarGitHub(),content:n.lorem.lines({min:1,max:3}),time:n.date.past()});return o},D=t=>{const o=[];for(let r=0;r<t;r+=1)o.push(n.image.urlPicsumPhotos());return o},x=t=>{const o=[];for(let r=0;r<t;r+=1)o.push(n.image.avatarGitHub());return o},h=t=>{const o=[],r=new Set;for(;o.length<t;){const k=n.helpers.enumValue(Y);r.has(k)||(o.push(k),r.add(k))}return o},Z={tasks:{"task-1":{id:"task-1",title:n.lorem.words(3),reporter:n.image.avatarGitHub(),priority:f.LOW,tags:[],comments:[],attachments:[]},"task-2":{id:"task-2",title:n.lorem.words(3),reporter:n.image.avatarGitHub(),assignee:x(1),date:n.date.future(),priority:f.HIGH,tags:h(3),comments:g(1),attachments:D(4)},"task-3":{id:"task-3",title:n.lorem.words(4),reporter:n.image.avatarGitHub(),assignee:x(2),priority:f.MEDIUM,date:n.date.future(),tags:h(2),comments:g(2),attachments:[]},"task-4":{id:"task-4",title:n.lorem.words(5),reporter:n.image.avatarGitHub(),assignee:x(3),priority:f.MEDIUM,tags:h(3),date:n.date.future(),description:n.lorem.lines(5),attachments:[],comments:g(3)},"task-5":{id:"task-5",title:n.lorem.words(4),reporter:n.image.avatarGitHub(),priority:f.HIGH,assignee:x(4),tags:h(4),date:n.date.future(),description:n.lorem.lines(3),attachments:[],comments:g(4)},"task-6":{id:"task-6",title:n.lorem.words(5),reporter:n.image.avatarGitHub(),priority:f.LOW,assignee:x(5),tags:h(5),date:n.date.future(),description:n.lorem.lines(4),attachments:D(5),comments:g(4)}},columns:{"column-1":{id:"column-1",title:"To do",taskIds:["task-1","task-2","task-3"]},"column-2":{id:"column-2",title:"In progress",taskIds:["task-4","task-5"]},"column-3":{id:"column-3",title:"Done",taskIds:["task-6"]}},columnOrder:["column-1","column-2","column-3"]};function mt(){const[t,o]=p.useState(Z),[r,k]=p.useState(null),[v,O]=p.useState(null),[H,w]=p.useState(!1),I=p.useRef(null),G=R(W(Q,{activationConstraint:{distance:8}})),A=s=>{const{active:e}=s;k(e.id),O(e.id.toString().startsWith("task-")?"task":"column")},E=s=>{const{active:e,over:i}=s;if(!i){k(null),O(null);return}if(e.id!==i.id)if(v==="column"){const a=t.columnOrder.indexOf(e.id),c=t.columnOrder.indexOf(i.id);o({...t,columnOrder:y(t.columnOrder,a,c)})}else{const a=Object.values(t.columns).find(d=>d.taskIds.includes(e.id)),c=Object.values(t.columns).find(d=>d.taskIds.includes(i.id)||d.id===i.id);if(!a||!c)return;if(a===c){const d=y(a.taskIds,a.taskIds.indexOf(e.id),a.taskIds.indexOf(i.id));o({...t,columns:{...t.columns,[a.id]:{...a,taskIds:d}}})}else{const d=a.taskIds.filter(P=>P!==e.id),l=[...c.taskIds],m=c.taskIds.indexOf(i.id);l.splice(m>=0?m:l.length,0,e.id),o({...t,columns:{...t.columns,[a.id]:{...a,taskIds:d},[c.id]:{...c,taskIds:l}}})}}k(null),O(null)};X("click",s=>{if(I.current&&!I.current.contains(s.target)){const e=I.current.value;e&&N({id:n.string.uuid(),title:e,taskIds:[]}),w(!1)}});const N=s=>{const e={...t,columns:{...t.columns,[s.id]:s},columnOrder:[...t.columnOrder,s.id]};o(e)},C=(s,e)=>{const i=t.columns[s],a={...t,tasks:{...t.tasks,[e.id]:e},columns:{...t.columns,[s]:{...i,taskIds:[...i.taskIds,e.id]}}};o(a)},S=s=>{const e=t.columns[s],i=Object.keys(t.tasks).filter(l=>!e.taskIds.includes(l)).reduce((l,m)=>(l[m]=t.tasks[m],l),{}),a=Object.keys(t.columns).filter(l=>l!==s).reduce((l,m)=>(l[m]=t.columns[m],l),{}),c=Array.from(t.columnOrder).filter(l=>l!==s);o({tasks:i,columns:a,columnOrder:c})},j=s=>{const e=t.columns[s],i=Object.keys(t.tasks).filter(d=>!e.taskIds.includes(d)).reduce((d,l)=>(d[l]=t.tasks[l],d),{}),a={...t.columns,[s]:{...e,taskIds:[]}},c={...t,tasks:i,columns:a};o(c)},b=s=>{const{id:e,title:i}=s,a={...t.columns,[e]:{...t.columns[e],title:i}},c={...t,columns:a};o(c)};return u.jsxs(K,{type:"hover",children:[u.jsxs("div",{className:"flex w-full",children:[u.jsx(q,{sensors:G,onDragStart:A,onDragEnd:E,children:u.jsxs("div",{className:"flex h-full items-start gap-6 p-1",children:[u.jsx(U,{items:t.columnOrder,strategy:V,children:t.columnOrder.map((s,e)=>{const i=t.columns[s],a=i.taskIds.map(c=>t.tasks[c]);return u.jsx(T,{id:s,index:e,column:i,tasks:a,createTask:C,clearColumn:j,deleteColumn:S,renameColumn:b},s)})}),u.jsxs(F,{children:[r&&v==="column"?u.jsx(T,{id:r,index:t.columnOrder.indexOf(r),column:t.columns[r],tasks:t.columns[r].taskIds.map(s=>t.tasks[s]),createTask:C,clearColumn:j,deleteColumn:S,renameColumn:b,isDragging:!0}):null,r&&v==="task"?u.jsx(J,{id:r,task:t.tasks[r],isDragging:!0}):null]})]})}),u.jsx("div",{className:"ml-[1.6rem] mt-[0.25rem] min-w-[280px]",children:H?u.jsx(L,{ref:I,placeholder:"Column Name",autoFocus:!0}):u.jsxs(M,{variant:"outline",onClick:s=>{s.stopPropagation(),w(!0)},className:"inline-flex! w-full! items-center justify-center text-xs! font-semibold!",children:[u.jsx(z,{icon:"carbon:add",size:20}),u.jsx("div",{children:"Add Column"})]})})]}),u.jsx(B,{orientation:"horizontal"})]})}export{mt as default};
