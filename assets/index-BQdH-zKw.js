import{i as W,u as X,j as i,C as Y,d as Z,B as $}from"./index-Bt7t-uRm.js";import{u as ee,A as o}from"./use-request-B4L2sB-F.js";import{r as d}from"./vendor-core-CiUIJZ_7.js";import te from"./credit-budget-add-payment-CBMMdle7.js";import ae from"./credit-budget-modal-_lk3Y_TR.js";import re from"./credit-budget-table-Cmo5Km52.js";import ie from"./show-data-selected-recorded-B5DpwpiZ.js";import{I as de,S as v,s as w}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";import"./form-B1s-44fp.js";import"./index.esm-BGUB25Qb.js";import"./input-D4IfRxCz.js";import"./persian-OLrIT8M7.js";import"./index-CkzAM18b.js";import"./table-actions-D0xANUJp.js";import"./converted-time-Dpp4WfBk.js";const se=t=>[{id:2,title:t("credits.credit_budget_origin.culoumns_header.radif"),value:"radif"},{id:0,title:t("credits.credit_budget_origin.culoumns_header.program"),value:"program"},{id:1,title:t("credits.credit_budget_origin.culoumns_header.faliat"),value:"faliat"},{id:3,title:t("credits.credit_budget_origin.culoumns_header.madeh"),value:"madeh"},{id:4,title:t("credits.credit_budget_origin.culoumns_header.sharhe_program"),value:"sharhe_program"},{id:5,title:t("credits.credit_budget_origin.culoumns_header.sharh_faliat"),value:"sharh_faliat"},{id:6,title:t("credits.credit_budget_origin.culoumns_header.sharh_hazineh"),value:"sharh_hazineh"}],{Option:oe}=v,j={radif:null,program:null,madeh:null,payment_description:null,faliat:null,sharh_faliat:null,sharh_hazineh:null,sharhe_program:null};function De(){const{t}=W(),{locale:M}=X(),[c,N]=d.useState({faliat:"",madeh:"",payment_description:"",program:"",radif:null,sharh_faliat:"",sharh_hazineh:"",sharhe_program:""}),[l,m]=d.useState({show:!1,title:t("credits.credit_budget_origin.title_modal_add"),formValue:j}),[n,_]=d.useState({show:!1,title:t("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:null,date_etebar:new Date().toLocaleString(),amount_etebar:null,assigningUnit:null}}),[h,B]=d.useState("radif"),[f,V]=d.useState(""),[x,E]=d.useState([]),[R,P]=d.useState([]),U=()=>{m({show:!0,title:t("credits.credit_budget_origin.title_modal_add"),formValue:j})},C=(e,a)=>{e?.amount_etebar?_({show:!0,title:t("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:e.number_etebar,date_etebar:e.date_etebar??"",amount_etebar:e.amount_etebar??null,assigningUnit:e.assigningUnit??null},id:a}):_({show:!0,title:t("credits.credit_budget_origin.title_modal_add"),formValue:{number_etebar:null,date_etebar:"",amount_etebar:null,assigningUnit:null},id:a})},z=e=>{m({show:!0,title:t("credits.credit_budget_origin.title_modal_edit"),formValue:e})},y=()=>{m(e=>({...e,show:!1}))},S=()=>{_(e=>({...e,show:!1}))},A=d.useMemo(()=>x.filter(e=>{const a=e[h];return a==null?!1:a.toString().toLowerCase().includes(f.toLowerCase())}),[x,f,h]),[k,D]=d.useState(Date.now()),[I,g]=d.useState(Date.now()),s=ee(),p=s.useGetData("api/credit-origin-budget",{Authorization:o}),u=s.useGetData("api/addcredit",{Authorization:o}),K=s.useUpdateData("api/credit-origin-budget/"+l.formValue.id,{"content-type":"application/json",Authorization:o}),L=s.usePostData("api/credit-origin-budget",{"content-type":"application/json",Authorization:o}),O=s.usePostData("api/addcredit",{"content-type":"application/json",Authorization:o}),F=s.useUpdateData("api/addcredit/"+n.id,{"content-type":"application/json",Authorization:o}),H=s.useDeleteData("api/credit-origin-budget/",{"content-type":"application/json",Authorization:o}),T=s.useDeleteData("api/addcredit/",{"content-type":"application/json",Authorization:o});d.useEffect(()=>{p.fetchData()},[k]),d.useEffect(()=>{const e=p.data;e?.success&&e.data&&E(e.data)},[p.data]),d.useEffect(()=>{c?.id&&u.fetchData()},[I]),d.useEffect(()=>{if(u.data?.data){const e=u.data?.data||[],a=[];e.forEach(r=>{r.credit_budget_id&&r.credit_budget_id===c.id&&a.push(r)}),P(a)}},[u.data?.data]);const q=async e=>{N(e),g(Date.now())},G=async(e,a)=>{let r;a==="add"?r=await L.sendData({barname_id:2,faaliat_id:3,radif:e.radif,madeh:e.madeh,payment_description:e.payment_description}):r=await K.sendData({barname_id:2,faaliat_id:3,radif:e.radif,madeh:e.madeh,payment_description:e.payment_description}),r&&D(Date.now()),y()},Q=async(e,a)=>{const r=e.date_etebar?new Date(e.date_etebar).toISOString():null;let b;a==="add"?b=await O.sendData({number_etebar:e.number_etebar,yegan_vagozar_id:2,amount_etebar:Number(e.amount_etebar),date_etebar:r,credit_budget_id:n.id}):b=await F.sendData({number_etebar:e.number_etebar,yegan_vagozar_id:2,amount_etebar:Number(e.amount_etebar),date_etebar:r,credit_budget_id:n.id}),b&&g(Date.now()),S()},J=async(e,a="budget")=>{try{let r;r=a==="budget"?await H.remove(e.toString()):await T.remove(e.toString()),r?.success?(w.success("با موفقیت حذف شد"),a==="budget"?D(Date.now()):g(Date.now())):w.error("خطا در حذف")}catch(r){w.error(r.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}};return i.jsxs(Y,{children:[i.jsx(Z,{children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 w-full ",style:{direction:M==="fa_IR"?"rtl":"ltr"},children:[i.jsx("div",{className:"text-lg font-semibold text-right w-full sm:w-auto",children:t("credits.credit_budget_origin.title_page")}),i.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center border p-3 rounded-md bg-card text-card-foreground  w-full sm:w-auto",children:[i.jsx("div",{className:"flex gap-1 items-center justify-start",children:i.jsx(de,{placeholder:t("credits.credit_budget_origin.search_placeholder"),value:f,onChange:e=>V(e.target.value),allowClear:!0,className:"w-full sm:w-52"})}),i.jsx(v,{value:h,onChange:e=>B(e),className:"w-48",children:se(t).map((e,a)=>i.jsx(oe,{value:e.value,children:e.title},a))})]}),i.jsx($,{onClick:U,className:"w-full sm:w-auto cursor-pointer whitespace-nowrap text-common-white",children:t("credits.credit_budget_origin.button_add_creadits_origin")})]})]})}),i.jsx(re,{onEdit:z,data:A,openCreateModalCredit:C,showDataCredits:q}),c.id&&i.jsx(ie,{dataSelected:R,selectedRecord:c,openCreateModalCredit:C,onDelete:J}),l.show&&i.jsx(ae,{title:l.title,show:l.show,formValue:l.formValue,onOk:G,onCancel:y}),n.show&&i.jsx(te,{title:n.title,show:n.show,formValue:n.formValue,onOk:Q,onCancel:S})]})}export{De as default};
