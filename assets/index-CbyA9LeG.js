import{j as e,D as I,E as k,F as M,G as P,B as g,a3 as y,C as R,d as G}from"./index-Bt7t-uRm.js";import{u as H}from"./use-request-B4L2sB-F.js";import{u as L,b as A}from"./user-ReaFp5d6.js";import{r as m}from"./vendor-core-CiUIJZ_7.js";import{u as U,C as w}from"./index.esm-BGUB25Qb.js";import{I as E,F as K,f as O,c as V,s as f}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";function q({title:c,show:o,formValue:a,onOk:x,onCancel:l}){const{control:d,handleSubmit:h,reset:n,formState:{errors:r,isValid:i}}=U({defaultValues:a,mode:"onChange"});m.useEffect(()=>{n(a)},[a,n]);const p=t=>{x(t,a.id?"edit":"add")};return e.jsx(I,{open:o,onOpenChange:t=>!t&&l(),children:e.jsxs(k,{children:[e.jsx(M,{children:e.jsx(P,{children:c})}),e.jsxs("form",{onSubmit:h(p),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"کد فعالیت"}),e.jsx(w,{name:"code",control:d,rules:{required:"کد فعالیت الزامی است",pattern:{value:/^[0-9]+$/,message:"کد فعالیت باید فقط عدد باشد"},minLength:{value:1,message:"کد فعالیت باید حداقل ۱ رقم باشد"},maxLength:{value:10,message:"کد فعالیت باید حداکثر ۱۰ رقم باشد"}},render:({field:t})=>e.jsx(E,{...t,type:"number",value:t.value||"",className:"w-full"})}),r.code&&e.jsx("p",{className:"text-error mt-1 text-sm",children:r.code.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"توضیحات"}),e.jsx(w,{name:"description",control:d,rules:{required:"توضیحات الزامی است",minLength:{value:3,message:"توضیحات باید حداقل ۳ کاراکتر باشد"},maxLength:{value:200,message:"توضیحات باید حداکثر ۲۰۰ کاراکتر باشد"}},render:({field:t})=>e.jsx(E,{...t,value:t.value||"",className:"w-full"})}),r.description&&e.jsx("p",{className:"text-error mt-1 text-sm",children:r.description.message})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{type:"button",className:"px-5 py-2 rounded-md ml-2 border-gray-300 text-white bg-error/50 hover:bg-error",onClick:l,children:"انصراف"}),e.jsx(g,{type:"submit",disabled:!i,className:`px-5 py-2 rounded-md text-white ${i?"bg-success/70 hover:bg-success":"bg-gray-400 cursor-not-allowed"}`,children:a.id?"ویرایش":"افزودن"})]})]})]})})}function B({data:c,onEdit:o,onDelete:a}){const{can:x}=L(),{operationList:l,resourceList:d}=y,h=()=>{const n={canEdit:x(d.FAALIAT,l.UPDATE),canDelete:x(d.FAALIAT,l.DELETE)},r=[{title:"نام",dataIndex:"description",key:"description"},{title:"کد فعالیت",dataIndex:"code",key:"code"}],i={title:"عملیات",key:"actions",render:(p,t)=>e.jsxs(O,{children:[n.canEdit&&e.jsx(g,{onClick:()=>o(t),className:"bg-chart3 text-white font-bold hover:bg-primary cursor-pointer ",children:"ویرایش"}),n.canDelete&&e.jsx(V,{title:"آیا مطمئن هستید؟",onConfirm:()=>a(t.id),okText:"بله",cancelText:"خیر",children:e.jsx(g,{className:"bg-error-light hover:bg-error cursor-pointer text-white",children:"حذف"})})]})};return(n.canEdit||n.canDelete)&&r.push(i),r};return e.jsx(K,{dataSource:c,columns:h(),rowKey:"id"})}const $={code:null,description:null};function _(){const{can:c}=L(),{operationList:o,resourceList:a}=y,[x,l]=m.useState(""),[d,h]=m.useState([]),[n,r]=m.useState(Date.now()),[i,p]=m.useState({show:!1,title:"افزودن فعالیت جدید",formValue:$}),t=H(),b=t.useGetData(A(a.FAALIAT,o.GETALL));m.useEffect(()=>{let s=!0;return s&&c(a.FAALIAT,o.GETALL)&&b.fetchData(),()=>{s=!1}},[n]),m.useEffect(()=>{const s=b.data;s?.success&&s.data&&h(s.data)},[b.data]);const C=t.usePostData(A(a.FAALIAT,o.CREATE)),T=t.useUpdateData(A(a.FAALIAT,o.UPDATE)),N=t.useDeleteData(A(a.FAALIAT,o.DELETE)),v=()=>{p(s=>({...s,show:!1}))},D=s=>{p({show:!0,title:"ویرایش  فعالیت",formValue:{code:s?.code,id:s?.id,description:s?.description}})},F=async(s,u)=>{let j;u==="add"?j=await C.sendData({code:Number(s.code),description:s.description}):j=await T.sendData({code:Number(s.code),description:s.description}),j&&(r(Date.now()),u==="add"?f.success(" فعالیت جدید اضافه شد"):f.info(" فعالیت ویرایش شد")),v()},S=async s=>{try{let u;s&&(u=await N.remove("/"+s.toString())),u?.success?(f.success("با موفقیت حذف شد"),r(Date.now())):f.error("خطا در حذف")}catch(u){f.error(u.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}};return e.jsxs(R,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:"مدیریت فعالیت ها"}),e.jsxs("div",{className:"flex gap-2",children:[c(a.FAALIAT,o.SEARCH)&&e.jsx(E,{placeholder:"جستجو...",value:x,onChange:s=>l(s.target.value),className:"w-60",allowClear:!0}),c(a.FAALIAT,o.CREATE)&&e.jsx(g,{className:"text-white bg-primary/95 hover:bg-primary ",onClick:()=>D({code:null,description:null}),children:"افزودن فعالیت"})]})]})}),e.jsx(B,{data:d,onEdit:D,onDelete:S}),i.show&&e.jsx(q,{title:i.title,show:i.show,formValue:i.formValue,onOk:F,onCancel:v})]})}const ee=()=>e.jsx(_,{});export{ee as default};
