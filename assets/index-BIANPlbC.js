import{a3 as V,j as t,d as k,B as p,e as _,C as L}from"./index-Bt7t-uRm.js";import{u as v}from"./use-request-B4L2sB-F.js";import{u as F,b as m}from"./user-ReaFp5d6.js";import{r as n}from"./vendor-core-CiUIJZ_7.js";import{e as h,I as E,F as G,M as I,s as o,f as U,c as H}from"./vendor-ui-DnFwFa5O.js";import"./vendor-utils-IiNHtr66.js";const g={number_hesab:null,name:null},q=()=>{const{can:l}=F(),{operationList:a,resourceList:r}=V,[j,C]=n.useState([]),[f]=h.useForm(),[D,y]=n.useState(""),[w,A]=n.useState(Date.now()),[i,u]=n.useState({show:!1,title:"افزودن پیمان کار جدید",formValue:g}),d=v(),x=d.useGetData(m(r.PEYMANKAR,a.GETALL)),N=d.useUpdateData(m(r.PEYMANKAR,a.UPDATE,i?.formValue.id)),P=d.usePostData(m(r.PEYMANKAR,a.CREATE)),S=d.useDeleteData(m(r.PEYMANKAR,a.DELETE));n.useEffect(()=>{l(r.PEYMANKAR,a.GETALL)&&x.fetchData()},[w]),n.useEffect(()=>{const e=x.data;e?.success&&e.data&&C(e.data)},[x.data]);const T=()=>{u(e=>({...e,show:!1}))},Y=async(e,s)=>{let c;s==="add"?c=await P.sendData({number_hesab:e.number_hesab?.toString(),name:e.name}):c=await N.sendData({number_hesab:Number(e.number_hesab).toString(),name:e.name}),c?(A(Date.now()),s==="add"?o.success("با موفقیت اضافه  شد"):o.info("با موفقیت ویرایش شد")):o.error("خطا در ارسال اطلاعات"),T()},M=async e=>{try{let s;e&&(s=await S.remove("/"+e.toString())),s?.success?(o.success("با موفقیت حذف شد"),A(Date.now())):o.error("خطا در حذف")}catch(s){o.error(s.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},R=()=>{const e={canEdit:l(r.YEGAN,a.UPDATE),canDelete:l(r.YEGAN,a.DELETE)},s=[{title:"نام پیمانکار",dataIndex:"name",key:"name"},{title:"شماره حساب ",dataIndex:"number_hesab",key:"number_hesab"}],c={title:"عملیات",key:"actions",render:(B,b)=>t.jsxs(U,{children:[e.canEdit&&t.jsx(p,{className:"bg-primary/90 hover:bg-primary text-white cursor-pointer  font-bold",onClick:()=>{f.setFieldsValue(b),u(K=>({show:!0,title:"ویرایش پیمانکار",formValue:{...K.formValue,id:b.id}}))},children:"ویرایش"}),e.canDelete&&t.jsx(H,{title:"آیا مطمئن هستید؟",onConfirm:()=>M(b.id??null),children:t.jsx(p,{className:"bg-error-light hover:bg-error font-bold  cursor-pointer text-white",children:"حذف"})})]})};return(e.canEdit||e.canDelete)&&s.push(c),s};return t.jsxs(t.Fragment,{children:[t.jsxs(k,{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold  text-right w-full sm:w-auto",children:"مدیریت یگان ها"}),t.jsxs("div",{className:"flex items-center gap-2",children:[l(r.YEGAN,a.SEARCH)&&t.jsx(E,{placeholder:"جستجوی    پیمانکار",value:D,onChange:e=>y(e.target.value),style:{maxWidth:300}}),l(r.YEGAN,a.CREATE)&&t.jsx(p,{onClick:()=>u(e=>({...e,show:!0})),className:"bg-primary/95 text-white dark:bg-primary",children:"افزودن پیمانکار جدید"})]})]}),t.jsx(_,{children:t.jsx(G,{rowKey:"id",columns:R(),dataSource:j,pagination:{pageSize:5}})}),t.jsx(I,{title:i.title,open:i.show,onCancel:()=>{u(e=>({...e,show:!1,formValue:g}))},onOk:()=>f.submit(),okText:i.formValue.id?"ویرایش ":"افزودن",cancelText:"لغو",children:t.jsxs(h,{form:f,layout:"vertical",onFinish:e=>{const s={...e};Y(s,i.formValue.id?"edit":"add")},children:[t.jsx(h.Item,{name:"name",label:"نام پیمانکار",rules:[{required:!0}],children:t.jsx(E,{})}),t.jsx(h.Item,{name:"number_hesab",label:"شماره حساب پیمانکار ",rules:[{required:!0}],children:t.jsx(E,{type:"number"})})]})})]})},Z=()=>t.jsx(L,{children:t.jsx(q,{})});export{Z as default};
