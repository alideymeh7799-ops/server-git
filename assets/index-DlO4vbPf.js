import{j as e,D as k,E as I,F as M,G as P,H as U,B as u,a3 as V,C as G,d as H,e as z,I as b}from"./index-Bt7t-uRm.js";import"./vendor-utils-IiNHtr66.js";import{u as K}from"./use-request-B4L2sB-F.js";import{u as _,b as p}from"./user-ReaFp5d6.js";import{F as B,s as m,f as q,c as J}from"./vendor-ui-DnFwFa5O.js";import{r as c}from"./vendor-core-CiUIJZ_7.js";import{u as Q}from"./index.esm-BGUB25Qb.js";import{F as W,a as w,b as C,e as L,c as S}from"./form-B1s-44fp.js";import{I as X}from"./input-D4IfRxCz.js";import{T as Y}from"./textarea-DdY3wtlb.js";function Z({title:l,show:n,formValue:t,onOk:j,onCancel:x}){const o=Q({defaultValues:t});c.useEffect(()=>{o.reset(t)},[t,o]);const i=o.handleSubmit(r=>{const h=t?.id?"edit":"add";j(r,h)});return e.jsx(k,{open:n,onOpenChange:r=>!r&&x(),children:e.jsxs(I,{children:[e.jsx(M,{children:e.jsx(P,{children:l})}),e.jsx(W,{...o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{control:o.control,name:"name",render:({field:r})=>e.jsxs(C,{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{className:"text-right",children:"نام نقش"}),e.jsx("div",{className:"col-span-3",children:e.jsx(S,{children:e.jsx(X,{...r,value:r.value||void 0})})})]})}),e.jsx(w,{control:o.control,name:"description",render:({field:r})=>e.jsxs(C,{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{className:"text-right",children:"توضیحات"}),e.jsx("div",{className:"col-span-3",children:e.jsx(S,{children:e.jsx(Y,{...r,value:r.value||void 0})})})]})})]})}),e.jsxs(U,{className:"pt-4",children:[e.jsx(u,{className:"bg-error hover:bg-error text-white",onClick:x,children:"انصراف"}),e.jsx(u,{className:"bg-primary text-white",onClick:i,children:t.id?"ویرایش":"افزودن"})]})]})})}const g={name:null,description:null};function $(){const{can:l}=_(),{operationList:n,resourceList:t}=V,[j,x]=c.useState([]),[o,i]=c.useState({formValue:{...g},title:"ساخت نقش جدید",show:!1}),[r,h]=c.useState(Date.now()),f=K(),E=f.useGetData(p(t.ROLES,n.GETALL));c.useEffect(()=>{let s=!0;return s&&l(t.ROLES,n.GETALL)&&E.fetchData(),()=>{s=!1}},[r]),c.useEffect(()=>{const s=E.data;s?.success&&s.data&&x(s.data)},[E.data]);const N=f.usePostData(p(t.ROLES,n.CREATE)),R=f.useUpdateData(p(t.ROLES,n.UPDATE,o?.formValue.id)),v=async(s,a)=>{let d;a==="add"?d=await N.sendData({name:s.name,description:s.description}):d=await R.sendData({name:s.name,description:s.description}),d&&(h(Date.now()),a==="add"?m.success(" برنامه جدید اضافه شد"):m.info(" برنامه ویرایش شد")),i({formValue:{...g},title:"ساخت نقش جدید",show:!1})},F=f.useDeleteData(p(t.ROLES,n.DELETE)),T=async s=>{try{let a;s&&(a=await F.remove("/"+s.toString())),a?.success?(m.success("با موفقیت حذف شد"),h(Date.now())):m.error("خطا در حذف")}catch(a){m.error(a.status==="500"?"خطا در ارتباط با سرور":"خطایی رخ داده است")}},y=()=>{const s={canEdit:l(t.ROLES,n.UPDATE),canDelete:l(t.ROLES,n.DELETE)},a=[{title:"نام نقش",dataIndex:"name",width:300},{title:"کد نقش",dataIndex:"code"},{title:"توضیحات",dataIndex:"description"}],d={title:"عملیات",key:"actions",render:(ee,D)=>e.jsxs(q,{children:[s.canEdit&&e.jsxs(u,{onClick:()=>A(D),className:"bg-chart3 text-white font-bold hover:bg-primary cursor-pointer ",children:[e.jsx(b,{icon:"solar:pen-bold-duotone",size:18}),"ویرایش"]}),s.canDelete&&e.jsx(J,{title:"آیا مطمئن هستید؟",onConfirm:()=>T(Number(D.id)),okText:"بله",cancelText:"خیر",children:e.jsxs(u,{className:"bg-error-light hover:bg-error cursor-pointer text-white",children:["حذف",e.jsx(b,{icon:"mingcute:delete-2-fill",size:18,className:"text-white!"})]})})]})};return(s.canEdit||s.canDelete)&&a.push(d),a},O=()=>{i(s=>({...s,show:!0,title:"ساخت نقش جدید",formValue:{...s.formValue,...g}}))},A=s=>{i(a=>({...a,show:!0,title:"ویرایش نقش",formValue:s}))};return e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:"مدیریت نقش‌ها"}),e.jsx(u,{className:"bg-primary text-white",onClick:O,children:"ساخت نقش جدید"})]})}),e.jsx(z,{children:e.jsx(B,{rowKey:"id",size:"small",scroll:{x:"max-content"},pagination:!1,columns:y(),dataSource:j})}),e.jsx(Z,{onOk:v,formValue:o.formValue,show:o.show,title:o.title,onCancel:()=>{i(s=>({...s,show:!1,title:"افزودن نقش"}))}})]})}const me=()=>e.jsx($,{});export{me as default};
