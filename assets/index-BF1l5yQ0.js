import{j as e,d as Q,a3 as W,e as X,C as Z}from"./index-akJh1a2u.js";import{c as ee}from"./converted-time-Dpp4WfBk.js";import{u as te}from"./use-request-D0F366jR.js";import{u as ae,b as se}from"./user-Broof_Gn.js";import{r as a}from"./vendor-core-CiUIJZ_7.js";import{P as z}from"./index-C7VwecpD.js";import{p as P}from"./persian-OLrIT8M7.js";import{D as H,p as R}from"./index-CkzAM18b.js";import{e as u,B as C,F as w,M as O,I as y,S as b,f as L}from"./vendor-ui-DnFwFa5O.js";/* empty css               */import"./vendor-utils-IiNHtr66.js";const{Option:Y}=b,q=[{title:"ردیف",dataIndex:"radif",key:"radif"},{title:"مبلغ پرداختی",dataIndex:"amount",key:"amount"},{title:"نوع پرداخت",dataIndex:"type",key:"type"},{title:"شرح سند",dataIndex:"desc",key:"desc"},{title:"تاریخ سند",dataIndex:"date",key:"date"},{title:"شماره حساب",dataIndex:"account",key:"account"},{title:"نام و نشان",dataIndex:"owner",key:"owner"}],ne=({selectedRow:n})=>{const f=a.useRef(null),[r,g]=a.useState([]),[j,c]=a.useState(!1),[m]=u.useForm(),l=s=>{const p=s.date&&typeof s.date.format=="function"?s.date.format("YYYY/MM/DD"):"",I={radif:s.radif,amount:Number(s.amount),type:s.type,desc:s.desc,date:p,account:s.account,owner:s.owner,key:Date.now()};g(k=>[...k,I]),c(!1),m.resetFields()},d=r.reduce((s,p)=>s+Number(p.amount||0),0);return e.jsxs("div",{className:"bg-muted/30 border rounded-xl shadow-sm p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-700",children:"لیست اسناد نقد پرداخت"}),e.jsx(C,{type:"primary",onClick:()=>c(!0),children:"افزودن اعلامیه برگشتی"})]}),e.jsx(z,{dataExcel:{data:r,nameFile:`اسناد نقد پرداخت ${n?.program||""}`,nameSheet:n?.program||"",columns:q},dataPrint:{idSelcted:f.current,name:`اسناد نقد پرداخت ${n?.program||""}`}}),e.jsxs("div",{ref:f,className:"w-full",children:[e.jsx(w,{rowKey:s=>s.key,size:"small",columns:q,dataSource:r,pagination:!1,className:"bg-white rounded-xl shadow-sm border [&_.ant-table-thead_th]:bg-gray-100 [&_.ant-table-cell]:text-right"}),e.jsxs("div",{className:"text-sm font-semibold text-right pt-2 border-t mt-2",children:["جمع کل نقد پرداخت: ",d.toLocaleString()," ریال"]})]}),e.jsx(O,{title:"افزودن اعلامیه برگشتی نقدی",open:j,onCancel:()=>c(!1),onOk:()=>m.submit(),okText:"افزودن",cancelText:"انصراف",children:e.jsxs(u,{layout:"vertical",form:m,onFinish:l,scrollToFirstError:!0,initialValues:{type:"نقدی"},children:[e.jsx(u.Item,{name:"radif",label:"ردیف",rules:[{required:!0,message:"لطفا ردیف را وارد کنید"},{pattern:/^[0-9]+$/,message:"ردیف باید فقط شامل اعداد باشد"}],children:e.jsx(y,{placeholder:"مثلا: 1"})}),e.jsx(u.Item,{name:"amount",label:"مبلغ پرداختی",rules:[{required:!0,message:"لطفا مبلغ پرداختی را وارد کنید"},{pattern:/^\d+$/,message:"مبلغ باید فقط عدد باشد"},{validator:(s,p)=>p&&Number(p)>0?Promise.resolve():Promise.reject("مبلغ باید بزرگتر از صفر باشد")}],children:e.jsx(y,{type:"number",placeholder:"مثلا: 100000"})}),e.jsx(u.Item,{name:"type",label:"نوع پرداخت",rules:[{required:!0,message:"لطفا نوع پرداخت را انتخاب کنید"}],children:e.jsxs(b,{placeholder:"انتخاب کنید",children:[e.jsx(Y,{value:"نقدی",children:"نقدی"}),e.jsx(Y,{value:"کارت",children:"کارت"}),e.jsx(Y,{value:"سایر",children:"سایر"})]})}),e.jsx(u.Item,{name:"desc",label:"شرح سند",rules:[{required:!0,message:"لطفا شرح سند را وارد کنید"}],children:e.jsx(y.TextArea,{rows:2,placeholder:"توضیحات"})}),e.jsx(u.Item,{name:"date",label:"تاریخ سند",rules:[{required:!0,message:"لطفا تاریخ سند را انتخاب کنید"}],children:e.jsx(H,{calendar:P,locale:R,format:"YYYY/MM/DD",className:"w-full",placeholder:"انتخاب تاریخ"})}),e.jsx(u.Item,{name:"account",label:"شماره حساب",rules:[{required:!0,message:"لطفا شماره حساب را وارد کنید"}],children:e.jsx(y,{placeholder:"شماره حساب را وارد کنید"})}),e.jsx(u.Item,{name:"owner",label:"نام و نشان",rules:[{required:!0,message:"لطفا نام و نشان را وارد کنید"}],children:e.jsx(y,{placeholder:"نام و نشان را وارد کنید"})})]})})]})},re=({selectedUnit:n,onUnitChange:f,selectedAgent:r,onAgentChange:g,dataSettingsAmeleKharid:j,dataSettingsYegan:c})=>{const{Option:m}=b;return e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-3xl  ",children:"لیست سند های برگشتی"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(b,{className:"w-56",placeholder:"یگان مورد نظر را انتخاب کنید",value:n,onChange:f,allowClear:!0,children:c.map((l,d)=>e.jsx(m,{value:l.id,children:l.name+" کد یگان » "+l.code},d+1))}),e.jsx(b,{className:"w-56",placeholder:"عامل خرید مورد نظر را انتخاب کنید",value:r,onChange:g,allowClear:!0,children:j.map((l,d)=>e.jsx(m,{value:l.id,children:l.onvan_hesab+" شماره حساب  » "+l.number_hesab},d+1))})]})]})})},le=()=>{const n=[{id:1,radif:1,program:"برنامه اول",faliat:"فعالیت A",madeh:"ماده ۱",sharh_hazineh:"هزینه نمونه",sharhe_program:"شرح برنامه",sharh_faliat:"شرح فعالیت",noeEtebar:"نوع ۱"},{id:2,radif:2,program:"برنامه دوم",faliat:"فعالیت B",madeh:"ماده ۲",sharh_hazineh:"هزینه تست",sharhe_program:"شرح برنامه ۲",sharh_faliat:"شرح فعالیت ۲",noeEtebar:"نوع ۲"}],[f,r]=a.useState(!1),[g,j]=a.useState(null),[c,m]=a.useState(null),[l,d]=a.useState(0),[s,p]=a.useState(""),[I,k]=a.useState(""),[D,T]=a.useState([]),[N,S]=a.useState([]),[h,v]=a.useState({}),_=()=>{r(!0),j(null),m(null),d(0),p(""),k(""),v({})},x=(t,o,i)=>{d(t.amount),p(t.docCode),k(t.date??""),m(t.returnType??(i==="doc"?"سند برگشتی":"اعلام برگشتی")),j(o),r(!0),v({})},A=(t,o)=>{o==="doc"?T(i=>i.filter((J,E)=>E!==t)):S(i=>i.filter((J,E)=>E!==t))},G=()=>{const t={};return c||(t.returnType="لطفا نوع برگشتی را انتخاب کنید."),(!l||l<=0)&&(t.amount="مبلغ برگشتی باید بزرگتر از صفر باشد."),s.trim()||(t.docCode="کد مدرک یگان را وارد کنید."),I||(t.date="تاریخ برگشتی را انتخاب کنید."),v(t),Object.keys(t).length===0},$=()=>{if(!G())return;const t={buyer:"عامل خرید پیش‌فرض",amount:l,docCode:s,date:I,returnType:c||void 0};g!==null?c==="سند برگشتی"?T(o=>{const i=[...o];return i[g]=t,i}):S(o=>{const i=[...o];return i[g]=t,i}):c==="سند برگشتی"?T(o=>[...o,t]):S(o=>[...o,t]),r(!1),d(0),p(""),m(null),k(""),j(null),v({})},K=t=>t.reduce((o,i)=>o+Number(i.amount||0),0),B=[{title:"ردیف",dataIndex:"radif",key:"radif"},{title:"برنامه",dataIndex:"program",key:"program"},{title:"فعالیت",dataIndex:"faliat",key:"faliat"},{title:"ماده",dataIndex:"madeh",key:"madeh"},{title:"شرح هزینه",dataIndex:"sharh_hazineh",key:"sharh_hazineh"},{title:"شرح برنامه",dataIndex:"sharhe_program",key:"sharhe_program"},{title:"شرح فعالیت",dataIndex:"sharh_faliat",key:"sharh_faliat"},{title:"نوع اعتبار",dataIndex:"noeEtebar",key:"noeEtebar"},{title:"عملیات",key:"action",render:()=>e.jsx(C,{onClick:_,children:"ثبت سند برگشتی"})}],U=[{title:"عامل خرید",dataIndex:"buyer",key:"buyer"},{title:"مبلغ برگشتی",dataIndex:"amount",key:"amount"},{title:"مدرک یگان",dataIndex:"docCode",key:"docCode"},{title:"تاریخ سند",dataIndex:"date",key:"date"},{title:"نوع برگشتی",dataIndex:"returnType",key:"returnType"},{title:"عملیات",key:"actions",render:(t,o,i)=>e.jsxs(L,{children:[e.jsx(C,{onClick:()=>x(o,i,"doc"),children:"ویرایش"}),e.jsx(C,{danger:!0,onClick:()=>A(i,"doc"),children:"حذف"})]})}],V=[{title:"مبلغ برگشتی",dataIndex:"amount",key:"amount"},{title:"عامل خرید",dataIndex:"buyer",key:"buyer"},{title:"مدرک یگان",dataIndex:"docCode",key:"docCode"},{title:"تاریخ سند",dataIndex:"date",key:"date"},{title:"عملیات",key:"actions",render:(t,o,i)=>e.jsxs(L,{children:[e.jsx(C,{onClick:()=>x(o,i,"announcement"),children:"ویرایش"}),e.jsx(C,{danger:!0,onClick:()=>A(i,"announcement"),children:"حذف"})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(w,{columns:B,dataSource:n,rowKey:"id",pagination:!1}),e.jsx(O,{open:f,onCancel:()=>r(!1),onOk:$,title:"تخصیص اعتبار",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{placeholder:"نوع برگشتی",className:"w-full",value:c??void 0,onChange:t=>m(t),status:h.returnType?"error":"",children:[e.jsx(b.Option,{value:"اعلام برگشتی",children:"اعلام برگشتی"}),e.jsx(b.Option,{value:"سند برگشتی",children:"سند برگشتی"})]}),h.returnType&&e.jsx("div",{style:{color:"red",fontSize:12},children:h.returnType}),e.jsx("div",{children:"مانده تنخواه: ۵۰۰,۰۰۰ ریال"}),e.jsx(y,{type:"number",placeholder:"مبلغ برگشتی",value:l,onChange:t=>d(Number(t.target.value)),status:h.amount?"error":""}),h.amount&&e.jsx("div",{style:{color:"red",fontSize:12},children:h.amount}),e.jsx(y,{placeholder:"کد مدرک یگان",value:s,onChange:t=>p(t.target.value),status:h.docCode?"error":""}),h.docCode&&e.jsx("div",{style:{color:"red",fontSize:12},children:h.docCode}),e.jsx(y,{type:"date",value:I,onChange:t=>k(t.target.value),status:h.date?"error":""}),h.date&&e.jsx("div",{style:{color:"red",fontSize:12},children:h.date})]})}),e.jsx("h3",{children:"اسناد برگشتی"}),e.jsx(w,{columns:U,dataSource:D,pagination:!1,rowKey:t=>t.docCode+t.date,locale:{emptyText:"هیچ سند برگشتی ثبت نشده"}}),e.jsxs("div",{children:["جمع اسناد برگشتی: ",K(D).toLocaleString()]}),e.jsx("h3",{children:"اعلام برگشتی"}),e.jsx(w,{columns:V,dataSource:N,pagination:!1,rowKey:(t,o)=>t.docCode+o,locale:{emptyText:"هیچ اعلام برگشتی ثبت نشده"}}),e.jsxs("div",{children:["جمع اعلام برگشتی: ",K(N).toLocaleString()]})]})},{Option:M}=b,F=[{title:"ردیف",dataIndex:"radif",key:"radif"},{title:"مبلغ برگشتی",dataIndex:"amount",key:"amount"},{title:"عامل خرید",dataIndex:"agent",key:"agent"},{title:"مدر",dataIndex:"doc",key:"doc"},{title:"یگان",dataIndex:"unit",key:"unit"},{title:"تاریخ سند",dataIndex:"date",key:"date"},{title:"نوع برگشتی",dataIndex:"type",key:"type"}],de=({selectedRow:n})=>{const[f,r]=a.useState([]),[g,j]=a.useState(!1),[c]=u.useForm(),m=a.useRef(null),l=d=>{const s=d.date?.format("YYYY/MM/DD");r(p=>[...p,{...d,date:s,key:Date.now()}]),j(!1),c.resetFields()};return e.jsxs("div",{className:"bg-muted/30 border rounded-xl shadow-sm p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-base text-gray-700",children:"لیست اسناد برگشتی"}),e.jsx(C,{type:"primary",onClick:()=>j(!0),children:"افزودن سند برگشتی"})]}),e.jsx(z,{dataExcel:{data:f,nameFile:`لیست اسناد برگشتی ${n?.program||""}`,nameSheet:n?.program||"",columns:F},dataPrint:{idSelcted:m.current,name:`لیست اسناد برگشتی ${n?.program||""}`}}),e.jsxs("div",{ref:m,className:"w-full",children:[e.jsx(w,{rowKey:d=>d.key,size:"small",columns:F,dataSource:f,pagination:!1,className:"bg-white rounded-xl shadow-sm border [&_.ant-table-thead_th]:bg-gray-100 [&_.ant-table-cell]:text-right"}),e.jsxs("div",{className:"text-sm font-semibold text-right pt-2 border-t mt-2",children:["جمع کل مبلغ برگشتی: ",f.reduce((d,s)=>d+Number(s.amount||0),0).toLocaleString()," ریال"]})]}),e.jsx(O,{title:"افزودن سند برگشتی",open:g,onCancel:()=>j(!1),onOk:()=>c.submit(),okText:"افزودن",cancelText:"انصراف",children:e.jsxs(u,{layout:"vertical",form:c,onFinish:l,children:[e.jsx(u.Item,{name:"radif",label:"ردیف",rules:[{required:!0}],children:e.jsx(y,{})}),e.jsx(u.Item,{name:"amount",label:"مبلغ برگشتی",rules:[{required:!0}],children:e.jsx(y,{type:"number"})}),e.jsx(u.Item,{name:"agent",label:"عامل خرید",rules:[{required:!0}],children:e.jsx(y,{})}),e.jsx(u.Item,{name:"doc",label:"مدر",rules:[{required:!0}],children:e.jsx(y,{})}),e.jsx(u.Item,{name:"unit",label:"یگان",rules:[{required:!0}],children:e.jsx(y,{})}),e.jsx(u.Item,{name:"date",label:"تاریخ سند",rules:[{required:!0,message:"انتخاب تاریخ الزامی است"}],children:e.jsx(H,{calendar:P,locale:R,format:"YYYY/MM/DD",placeholder:"تاریخ را انتخاب کنید",className:"w-full",calendarPosition:"bottom-right"})}),e.jsx(u.Item,{name:"type",label:"نوع برگشتی",rules:[{required:!0}],children:e.jsxs(b,{children:[e.jsx(M,{value:"نوع ۱",children:"نوع ۱"}),e.jsx(M,{value:"نوع ۲",children:"نوع ۲"}),e.jsx(M,{value:"نوع ۳",children:"نوع ۳"})]})})]})})]})},oe=[{title:"مبلغ پرداختی",dataIndex:"amount",key:"amount",render:n=>n?n.toLocaleString():"-"},{title:"شرح تنخواه",dataIndex:"description",key:"description"},{title:"تاریخ تنخواه",dataIndex:"date_tankhah",key:"date_tankhah",render:n=>n?ee(n,"date"):"-"}];function ie(){const{can:n}=ae(),{operationList:f,resourceList:r}=W,[g,j]=a.useState([]),[c,m]=a.useState(),[l,d]=a.useState(null),[s,p]=a.useState(),[I,k]=a.useState(Date.now()),[D,T]=a.useState({yegan:[],amleKharid:[]}),N=te(),S=N.useGetData(se(r.TANKHAH,f.GETALL)),h=N.useGetData("api/getMany?resources="+r.YEGAN+","+r.AMELE_KHARID);a.useEffect(()=>{n(r.TANKHAH,f.GETALL)&&S.fetchData()},[I]),a.useEffect(()=>{n(r.YEGAN,f.GETALL)&&h.fetchData()},[]),a.useEffect(()=>{const x=h.data;x?.success&&x.data&&T({yegan:x.data[r.YEGAN],amleKharid:x.data[r.AMELE_KHARID]})},[h.data]),a.useEffect(()=>{const x=S.data;x?.success&&x.data&&j(x.data)},[S.data]);const v=x=>{m(x),d(null)},_=a.useCallback(x=>{p(x),d(null),k(Date.now())},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(re,{selectedUnit:c,onUnitChange:v,selectedAgent:s,onAgentChange:_,dataSettingsYegan:D.yegan,dataSettingsAmeleKharid:D.amleKharid}),e.jsxs(X,{children:[e.jsx(w,{rowKey:(x,A)=>`tankhah-${A}`,size:"small",columns:oe,dataSource:g,pagination:!1}),e.jsx(le,{}),l&&e.jsxs("div",{className:"mt-8 space-y-8",children:[e.jsx(de,{selectedRow:l}),e.jsx(ne,{selectedRow:l})]})]})]})}function ke(){return e.jsx(Z,{children:e.jsx(ie,{})})}export{ke as default};
